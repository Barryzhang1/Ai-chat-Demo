# 库存管理系统测试用例

## 1. 进货管理模块测试

### 1.1 创建进货单

#### 测试用例1.1.1：成功创建进货单
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入数据**：
  ```json
  {
    "supplierName": "XX供应商",
    "remark": "测试备注",
    "items": [
      {
        "productName": "商品A",
        "quantity": 100,
        "price": 12.50
      }
    ]
  }
  ```
- **预期结果**：
  - HTTP状态码：201
  - 返回进货单详情
  - 进货单状态为"pending"
  - 自动生成订单号（格式：PO + 日期 + 序号）

#### 测试用例1.1.2：创建进货单参数校验失败
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入数据**：供应商名称为空或商品数量为负数
- **预期结果**：
  - HTTP状态码：400
  - 返回参数错误信息

### 1.2 进货单审批

#### 测试用例1.2.1：BOSS用户批准进货单（新增）✅
- **前置条件**：
  - 用户已登录，角色为 BOSS
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用BOSS账号登录
  2. 调用审批接口批准进货单
- **输入数据**：
  ```json
  {
    "approve": true,
    "remark": "同意采购"
  }
  ```
- **预期结果**：
  - HTTP状态码：200
  - 返回成功信息
  - 进货单状态变为"approved"
  - 记录审批人ID和审批时间

#### 测试用例1.2.2：BOSS用户拒绝进货单（新增）✅
- **前置条件**：
  - 用户已登录，角色为 BOSS
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用BOSS账号登录
  2. 调用审批接口拒绝进货单
- **输入数据**：
  ```json
  {
    "approve": false,
    "remark": "供应商价格过高"
  }
  ```
- **预期结果**：
  - HTTP状态码：200
  - 返回成功信息
  - 进货单状态变为"cancelled"
  - 记录审批人ID、审批时间和拒绝原因

#### 测试用例1.2.3：STAFF用户尝试审批进货单（新增）❌
- **前置条件**：
  - 用户已登录，角色为 STAFF
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用STAFF账号登录
  2. 调用审批接口批准进货单
- **输入数据**：
  ```json
  {
    "approve": true,
    "remark": "同意采购"
  }
  ```
- **预期结果**：
  - HTTP状态码：403
  - 返回权限不足错误信息
  - 进货单状态保持"pending"不变

### 2.4 库存管理前端国际化（新增 2026-02-06）

#### 测试用例2.4.1：库存历史页面中英文切换
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 通过库存列表进入某一商品的库存历史页面
- **操作步骤**：
  1. 在角色选择页切换语言为中文
  2. 进入库存历史页面
  3. 返回角色选择页，将语言切换为英文
  4. 再次进入同一库存历史页面
- **预期结果**：
  - 中文模式下：
    - 顶部导航显示商品名称或“库存历史”
    - Tab 标题分别为“全部记录 / 进货记录 / 损耗记录”
    - 右上角按钮文案为“录入损耗”
    - 空状态提示分别为“暂无历史记录 / 暂无进货记录 / 暂无损耗记录”
  - 英文模式下：
    - 顶部导航显示商品名称或“Inventory History”
    - Tab 标题分别为“All Records / Purchase Records / Loss Records”
    - 右上角按钮文案为“Record Loss”
    - 空状态提示分别为“No history / No purchase records / No loss records”

#### 测试用例2.4.2：库存历史 Toast 与错误提示国际化
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 通过修改 URL 或模拟接口错误触发异常场景
- **操作步骤**：
  1. 将语言设置为中文
  2. 访问不带 inventoryId 的库存历史页面，或让接口返回错误 / 未登录状态
  3. 将语言切换为英文，重复上述操作
- **预期结果**：
  - 中文模式下：
    - 缺少库存ID时提示“缺少库存ID参数”
    - 登录失效时提示“登录已过期，请重新登录”
    - 历史加载失败时提示“获取历史记录失败”
    - 损耗录入成功时提示“损耗录入成功”，失败时提示“损耗录入失败”或“操作失败”
  - 英文模式下：
    - 缺少库存ID时提示“Missing inventory ID parameter”
    - 登录失效时提示“Login expired, please login again”
    - 历史加载失败时提示“Failed to fetch inventory history”
    - 损耗录入成功时提示“Loss recorded successfully”，失败时提示“Failed to record loss”或“Operation failed”

#### 测试用例2.4.3：损耗录入弹窗字段与占位符国际化
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 在库存历史页面点击“录入损耗”按钮
- **操作步骤**：
  1. 在中文模式下打开损耗录入弹窗，检查所有字段标签与占位符
  2. 切换语言为英文后再次打开弹窗，检查同样内容
- **预期结果**：
  - 中文模式下：
    - 标题为“录入损耗”
    - 字段标签依次为“商品名称 / 损耗数量 / 损耗原因 / 备注”
    - 占位符为“请输入损耗数量”“请输入损耗原因（如：过期、破损等）”“选填”
    - 底部按钮为“取消 / 确认录入”
  - 英文模式下：
    - 标题为“Record Loss”
    - 字段标签依次为“Product Name / Loss Quantity / Loss Reason / Remark”
    - 占位符为“Please enter loss quantity”“Please enter loss reason (e.g. expired, damaged)”“Optional”
    - 底部按钮为“Cancel / Confirm Record”

## 3. 测试用例变更记录
- **前置条件**：
  - 用户已登录，角色为 USER
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用USER账号登录
  2. 调用审批接口批准进货单
- **输入数据**：
  ```json
  {
    "approve": true,
    "remark": "同意采购"
  }
  ```
- **预期结果**：
  - HTTP状态码：403
  - 返回权限不足错误信息
  - 进货单状态保持"pending"不变

#### 测试用例1.2.5：审批非待审批状态的进货单
- **前置条件**：
  - 用户已登录，角色为 BOSS
  - 存在已审批/已完成/已取消的进货单
- **操作步骤**：
  1. 使用BOSS账号登录
  2. 调用审批接口批准进货单
- **预期结果**：
  - HTTP状态码：400
  - 返回"订单状态不允许审批"错误信息

#### 测试用例1.2.6：未登录用户尝试审批
- **前置条件**：用户未登录
- **操作步骤**：直接调用审批接口
- **预期结果**：
  - HTTP状态码：401
  - 返回未授权错误信息

### 1.3 进货入库

#### 测试用例1.3.1：成功确认入库
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 存在已审批的进货单
- **输入数据**：
  ```json
  {
    "remark": "货物已清点入库"
  }
  ```
- **预期结果**：
  - HTTP状态码：200
  - 进货单状态变为"completed"
  - 库存数量更新正确
  - 记录入库人ID和入库时间

#### 测试用例1.3.2：入库非已审批状态的进货单
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 进货单状态为"pending"或其他非"approved"状态
- **操作步骤**：调用入库接口
- **预期结果**：
  - HTTP状态码：400
  - 返回"订单状态不允许入库"错误信息

### 1.4 进货单查询

#### 测试用例1.4.1：查询所有进货单
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入参数**：`status=all&page=1&pageSize=20`
- **预期结果**：
  - HTTP状态码：200
  - 返回所有状态的进货单列表
  - 支持分页

#### 测试用例1.4.2：按状态筛选进货单
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入参数**：`status=pending&page=1&pageSize=20`
- **预期结果**：
  - HTTP状态码：200
  - 只返回待审批状态的进货单

#### 测试用例1.4.3：查询单个进货单详情
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 存在有效的进货单ID
- **操作步骤**：调用查询详情接口
- **预期结果**：
  - HTTP状态码：200
  - 返回完整的进货单信息，包括商品列表

## 2. 库存管理模块测试

### 2.1 库存查询

#### 测试用例2.1.1：查询库存列表
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入参数**：`status=all&page=1&pageSize=100`
- **预期结果**：
  - HTTP状态码：200
  - 返回库存列表，包含商品名称、数量、单价、总值、状态等信息

#### 测试用例2.1.2：按状态筛选库存
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入参数**：`status=low`
- **预期结果**：
  - HTTP状态码：200
  - 只返回低库存和缺货状态的商品

### 2.2 库存损耗录入（UI优化）✅

#### 测试用例2.2.1：在库存列表页直接录入损耗
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 在库存列表页面
  - 存在可用的库存商品
- **操作步骤**：
  1. 点击库存项目打开操作菜单
  2. 选择"录入损耗"选项
  3. 在弹窗中填写损耗信息
- **预期结果**：
  - 显示优化后的损耗录入弹窗（参考新品上架弹窗样式）
  - 弹窗采用三段式布局：标题栏+表单区（可滚动）+按钮区（固定底部）
  - 表单显示当前商品名称和库存数量
  - 表单包含：损耗数量、损耗原因、备注字段

#### 测试用例2.2.2：损耗数量验证
- **前置条件**：打开损耗录入弹窗
- **输入数据**：
  - 损耗数量为0或负数
  - 损耗数量超过当前库存
- **预期结果**：
  - 表单验证失败
  - 显示错误提示："损耗数量必须大于0"或"损耗数量不能超过当前库存"

#### 测试用例2.2.3：成功录入损耗
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 打开损耗录入弹窗
  - 当前库存为100
- **输入数据**：
  ```json
  {
    "quantity": 10,
    "reason": "过期损耗",
    "remark": "保质期到期"
  }
  ```
- **操作步骤**：
  1. 填写所有必填字段
  2. 点击"确认录入"按钮
- **预期结果**：
  - HTTP状态码：200或201
  - 显示成功提示
  - 弹窗自动关闭
  - 库存列表自动刷新
  - 商品库存数量从100减少到90

#### 测试用例2.2.4：取消录入损耗
- **前置条件**：打开损耗录入弹窗
- **操作步骤**：
  1. 填写部分表单内容
  2. 点击"取消"按钮或点击遮罩层
- **预期结果**：
  - 弹窗关闭
  - 表单数据不保存
  - 库存数量不变

#### 测试用例2.2.5：表单重置验证
- **前置条件**：已录入一次损耗
- **操作步骤**：
  1. 再次打开损耗录入弹窗
- **预期结果**：
  - 表单所有字段为空
  - 不保留上一次的输入内容

#### 测试用例2.2.6：UI样式一致性验证
- **前置条件**：分别查看新品上架弹窗和损耗录入弹窗
- **验证项**：
  - 标题栏：固定顶部，居中显示，样式一致
  - 表单区：可滚动，padding一致，字段布局相似
  - 按钮区：固定底部，两个按钮水平排列，样式一致
  - 颜色方案：主色调、边框、背景色保持统一
  - 字体大小：标题、标签、输入框字体大小一致
- **预期结果**：
  - 两个弹窗的视觉风格完全一致
  - 交互体验一致

### 2.3 库存历史查询

#### 测试用例2.3.1：查看库存变更历史
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 点击库存项目的"查看变更历史"
- **预期结果**：
  - 跳转到库存历史页面
  - 显示该商品的所有变更记录（进货、损耗、调整）

## 3. 测试用例变更记录

### 变更1：进货单审批权限控制（2026-02-01）

**变更内容**：
- 新增测试用例1.2.1：BOSS用户批准进货单
- 新增测试用例1.2.2：BOSS用户拒绝进货单
- 新增测试用例1.2.3：STAFF用户尝试审批进货单（应失败）
- 新增测试用例1.2.4：USER用户尝试审批进货单（应失败）

**变更原因**：
增加进货单审批的权限控制，只有BOSS角色才能审批进货单

**影响范围**：
- 后端：`purchase-order.controller.ts` 审批接口
- 前端：审批按钮显示逻辑（可选优化）

### 变更2：库存损耗录入UI优化（2026-02-05）

**变更内容**：
- 新增测试用例2.2.1：在库存列表页直接录入损耗
- 新增测试用例2.2.2：损耗数量验证
- 新增测试用例2.2.3：成功录入损耗
- 新增测试用例2.2.4：取消录入损耗
- 新增测试用例2.2.5：表单重置验证
- 新增测试用例2.2.6：UI样式一致性验证

**变更原因**：
优化库存损耗录入功能的用户体验，参考新品上架功能的UI设计，实现：
1. 在库存列表页直接录入损耗，无需跳转到历史页面
2. 创建独立的`InventoryLossFormPopup`组件，与`DishFormPopup`保持一致的视觉风格
3. 采用三段式固定布局，提升交互体验
4. 保持手动输入损耗原因的方式，保证灵活性

**影响范围**：
- 前端组件：新增 `ChatUI/src/components/InventoryLossFormPopup.js`
- 前端页面：修改 `ChatUI/src/pages/InventoryManagement/InventoryList.js`
- 前端页面：保留 `ChatUI/src/pages/InventoryManagement/InventoryHistory.js` 的历史查看功能
- API接口：使用现有的损耗录入接口，无需修改后端

### 变更3：库存管理前端国际化支持（2026-02-06）

**变更内容**：
- 新增测试用例2.4.1：库存历史页面中英文切换
- 新增测试用例2.4.2：库存历史 Toast 与错误提示国际化
- 新增测试用例2.4.3：损耗录入弹窗字段与占位符国际化

**变更原因**：
- 满足系统前端国际化需求，使库存管理相关页面支持中英文切换

**影响范围**：
- 前端：`ChatUI/src/pages/InventoryManagement/InventoryHistory.js` 文案国际化改造
- 前端：`ChatUI/src/i18n/translations.js` 新增库存管理相关文案键值

### 变更4：库存列表页面布局稳定性优化（2026-02-06）

**变更内容**：
- 新增测试用例2.5.1：中英文切换下卡片布局稳定性
- 新增测试用例2.5.2：不同屏幕宽度下的布局适配
- 新增测试用例2.5.3：超长文本的截断处理
- 新增测试用例2.5.4：时间格式化布局一致性

**变更原因**：
修复库存列表页面在中英文切换时出现的卡片布局混乱问题：
1. 英文标签比中文长，导致文本换行和卡片高度不一致
2. 时间格式在英文环境下显示更长，破坏布局对齐
3. 状态标签在不同语言下长度差异影响视觉效果
4. 缺少文本截断策略，超长内容影响整体布局

**影响范围**：
- 前端：`ChatUI/src/pages/InventoryManagement/InventoryList.js` - 优化List.Item布局结构
- 前端样式：`ChatUI/src/pages/InventoryManagement/InventoryManagement.css` - 新增文本截断和布局约束样式

**测试用例详情**：

#### 测试用例2.5.1：中英文切换下卡片布局稳定性
- **前置条件**：
  - 用户已登录并具有库存管理权限
  - 库存列表中有多条不同状态的数据
- **操作步骤**：
  1. 进入库存管理页面 (InventoryList)
  2. 观察中文状态下的卡片布局
  3. 切换到英文语言
  4. 观察英文状态下的卡片布局一致性
  5. 再次切换回中文，确认布局恢复正常
- **预期结果**：
  - 中英文下卡片高度应保持基本一致
  - 状态标签应始终在右上角位置对齐
  - 文本不应溢出容器边界

#### 测试用例2.5.2：不同屏幕宽度下的布局适配
- **前置条件**：库存列表有数据
- **操作步骤**：
  1. 在iPhone SE宽度(375px)下测试中英文切换
  2. 在标准iPhone宽度(414px)下测试
  3. 验证文本显示完整性
- **预期结果**：
  - 所有宽度下文本都应能完整或合理截断显示
  - 卡片内容不应出现横向滚动

#### 测试用例2.5.3：超长文本的截断处理
- **前置条件**：存在产品名称较长的库存项
- **操作步骤**：
  1. 查看包含长产品名称的库存项
  2. 切换中英文验证截断效果
- **预期结果**：
  - 超长产品名称应显示省略号"..."
  - 描述区域每行文本都有合理的最大宽度限制
  - 超长内容不影响卡片整体高度

#### 测试用例2.5.4：时间格式化布局一致性
- **前置条件**：库存列表中有最近更新的数据
- **操作步骤**：
  1. 观察中文环境下的时间显示格式
  2. 切换英文环境观察时间格式变化
  3. 验证时间区域占用空间一致性
- **预期结果**：
  - 中英文时间格式都应在一行内显示
  - 时间区域高度在两种语言下保持一致
  - 时间文本不应换行或溢出
