# 库存管理系统测试用例

## 1. 进货管理模块测试

### 1.1 创建进货单

#### 测试用例1.1.1：成功创建进货单
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入数据**：
  ```json
  {
    "supplierName": "XX供应商",
    "remark": "测试备注",
    "items": [
      {
        "productName": "商品A",
        "quantity": 100,
        "price": 12.50
      }
    ]
  }
  ```
- **预期结果**：
  - HTTP状态码：201
  - 返回进货单详情
  - 进货单状态为"pending"
  - 自动生成订单号（格式：PO + 日期 + 序号）

#### 测试用例1.1.2：创建进货单参数校验失败
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入数据**：供应商名称为空或商品数量为负数
- **预期结果**：
  - HTTP状态码：400
  - 返回参数错误信息

### 1.2 进货单审批

#### 测试用例1.2.1：BOSS用户批准进货单（新增）✅
- **前置条件**：
  - 用户已登录，角色为 BOSS
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用BOSS账号登录
  2. 调用审批接口批准进货单
- **输入数据**：
  ```json
  {
    "approve": true,
    "remark": "同意采购"
  }
  ```
- **预期结果**：
  - HTTP状态码：200
  - 返回成功信息
  - 进货单状态变为"approved"
  - 记录审批人ID和审批时间

#### 测试用例1.2.2：BOSS用户拒绝进货单（新增）✅
- **前置条件**：
  - 用户已登录，角色为 BOSS
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用BOSS账号登录
  2. 调用审批接口拒绝进货单
- **输入数据**：
  ```json
  {
    "approve": false,
    "remark": "供应商价格过高"
  }
  ```
- **预期结果**：
  - HTTP状态码：200
  - 返回成功信息
  - 进货单状态变为"cancelled"
  - 记录审批人ID、审批时间和拒绝原因

#### 测试用例1.2.3：STAFF用户尝试审批进货单（新增）❌
- **前置条件**：
  - 用户已登录，角色为 STAFF
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用STAFF账号登录
  2. 调用审批接口批准进货单
- **输入数据**：
  ```json
  {
    "approve": true,
    "remark": "同意采购"
  }
  ```
- **预期结果**：
  - HTTP状态码：403
  - 返回权限不足错误信息
  - 进货单状态保持"pending"不变

#### 测试用例1.2.4：USER用户尝试审批进货单（新增）❌
- **前置条件**：
  - 用户已登录，角色为 USER
  - 存在待审批的进货单
- **操作步骤**：
  1. 使用USER账号登录
  2. 调用审批接口批准进货单
- **输入数据**：
  ```json
  {
    "approve": true,
    "remark": "同意采购"
  }
  ```
- **预期结果**：
  - HTTP状态码：403
  - 返回权限不足错误信息
  - 进货单状态保持"pending"不变

#### 测试用例1.2.5：审批非待审批状态的进货单
- **前置条件**：
  - 用户已登录，角色为 BOSS
  - 存在已审批/已完成/已取消的进货单
- **操作步骤**：
  1. 使用BOSS账号登录
  2. 调用审批接口批准进货单
- **预期结果**：
  - HTTP状态码：400
  - 返回"订单状态不允许审批"错误信息

#### 测试用例1.2.6：未登录用户尝试审批
- **前置条件**：用户未登录
- **操作步骤**：直接调用审批接口
- **预期结果**：
  - HTTP状态码：401
  - 返回未授权错误信息

### 1.3 进货入库

#### 测试用例1.3.1：成功确认入库
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 存在已审批的进货单
- **输入数据**：
  ```json
  {
    "remark": "货物已清点入库"
  }
  ```
- **预期结果**：
  - HTTP状态码：200
  - 进货单状态变为"completed"
  - 库存数量更新正确
  - 记录入库人ID和入库时间

#### 测试用例1.3.2：入库非已审批状态的进货单
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 进货单状态为"pending"或其他非"approved"状态
- **操作步骤**：调用入库接口
- **预期结果**：
  - HTTP状态码：400
  - 返回"订单状态不允许入库"错误信息

### 1.4 进货单查询

#### 测试用例1.4.1：查询所有进货单
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入参数**：`status=all&page=1&pageSize=20`
- **预期结果**：
  - HTTP状态码：200
  - 返回所有状态的进货单列表
  - 支持分页

#### 测试用例1.4.2：按状态筛选进货单
- **前置条件**：用户已登录（BOSS/STAFF）
- **输入参数**：`status=pending&page=1&pageSize=20`
- **预期结果**：
  - HTTP状态码：200
  - 只返回待审批状态的进货单

#### 测试用例1.4.3：查询单个进货单详情
- **前置条件**：
  - 用户已登录（BOSS/STAFF）
  - 存在有效的进货单ID
- **操作步骤**：调用查询详情接口
- **预期结果**：
  - HTTP状态码：200
  - 返回完整的进货单信息，包括商品列表

## 2. 库存管理模块测试

### 2.1 库存查询
（此处省略具体测试用例）

### 2.2 库存损耗录入
（此处省略具体测试用例）

## 3. 测试用例变更记录

### 变更1：进货单审批权限控制（2026-02-01）

**变更内容**：
- 新增测试用例1.2.1：BOSS用户批准进货单
- 新增测试用例1.2.2：BOSS用户拒绝进货单
- 新增测试用例1.2.3：STAFF用户尝试审批进货单（应失败）
- 新增测试用例1.2.4：USER用户尝试审批进货单（应失败）

**变更原因**：
增加进货单审批的权限控制，只有BOSS角色才能审批进货单

**影响范围**：
- 后端：`purchase-order.controller.ts` 审批接口
- 前端：审批按钮显示逻辑（可选优化）
