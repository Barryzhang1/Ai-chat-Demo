# 收入管理系统测试用例

## 1. 后端API测试用例

### 1.1 收入统计接口测试

#### 测试用例 1.1.1：查询当日收入统计（默认当天）
**测试编号**: TC-REV-001  
**测试目标**: 验证当日收入统计数据的准确性  
**前置条件**: 
- 当天有已完成订单
- 订单中的菜品已绑定库存食材
- 使用 BOSS 角色 Token

**测试步骤**:
1. 发送 GET 请求到 `/api/revenue/stats/today`
2. 携带 BOSS Token

**预期结果**:
- 返回状态码 200
- 返回数据包含:
  - `date`: 当前日期 (YYYY-MM-DD)
  - `revenue`: 当日订单总收入
  - `cost`: 当日总成本
  - `materialCost`: 当日原材料成本（基于菜品绑定食材的实际价格）
  - `grossProfit`: 毛利润
  - `grossMarginRate`: 毛利率 (%)
  - `netProfit`: 净利润
  - `orderCount`: 订单数量
  - `extraIncome`: 额外收入
  - `extraExpense`: 额外支出
- 验证: `materialCost = Σ(每道菜品绑定食材的价格 × 数量)`
- 验证: `grossProfit = revenue - materialCost`
- 验证: `grossMarginRate = (grossProfit ÷ revenue) × 100`
- 验证: `cost = materialCost + extraExpense`
- 验证: `netProfit = grossProfit - extraExpense + extraIncome`

---

#### 测试用例 1.1.2：查询指定日期收入统计
**测试编号**: TC-REV-002  
**测试目标**: 验证指定日期的收入统计  
**前置条件**: 指定日期有已完成订单

**测试步骤**:
1. 发送 GET 请求到 `/api/revenue/stats/today?date=2026-01-30`
2. 携带 BOSS Token

**预期结果**:
- 返回状态码 200
- `date` 字段为 "2026-01-30"
- 统计数据仅包含该日期的订单

---

#### 测试用例 1.1.3：查询无订单日期的统计
**测试编号**: TC-REV-003  
**测试目标**: 验证无订单日期返回零值  
**测试步骤**: 查询一个没有订单的日期

**预期结果**:
- 返回状态码 200
- `revenue` = 0
- `cost` = 额外支出
- `grossProfit` = 0
- `netProfit` = 额外收入 - 额外支出
- `orderCount` = 0

---

#### 测试用例 1.1.4：查询月度收入统计（默认当月）
**测试编号**: TC-REV-004  
**测试目标**: 验证当月收入统计数据  
**前置条件**: 当月有已完成订单

**测试步骤**:
1. 发送 GET 请求到 `/api/revenue/stats/month`
2. 携带 BOSS Token

**预期结果**:
- 返回状态码 200
- `month` 字段为当前月份 (YYYY-MM)
- 统计数据包含本月所有订单
- 计算逻辑与当日统计相同

---

#### 测试用例 1.1.5：查询指定月份收入统计
**测试编号**: TC-REV-005  
**测试目标**: 验证指定月份的收入统计  
**测试步骤**: 查询 `/api/revenue/stats/month?date=2026-01`

**预期结果**:
- `month` 字段为 "2026-01"
- 仅统计 2026年1月的订单

---

#### 测试用例 1.1.6：查询总体收入统计
**测试编号**: TC-REV-006  
**测试目标**: 验证系统总体收入统计  
**测试步骤**:
1. 发送 GET 请求到 `/api/revenue/stats/total`
2. 携带 BOSS Token

**预期结果**:
- 返回状态码 200
- 统计所有已完成订单
- 包含所有额外收支
- 数据量最大

---

### 1.2 额外收支接口测试

#### 测试用例 1.2.1：批量创建额外收支（单条）
**测试编号**: TC-REV-007  
**测试目标**: 验证单条收支记录创建  
**前置条件**: 使用 BOSS Token

**请求体**:
```json
{
  "transactions": [
    {
      "type": "expense",
      "amount": 5000.00,
      "category": "房租",
      "description": "2月份店铺租金",
      "transactionDate": "2026-02-01"
    }
  ]
}
```

**预期结果**:
- 返回状态码 201
- `successCount` = 1
- 返回创建的记录，包含自动生成的 `transactionNo`
- 记录保存到数据库

---

#### 测试用例 1.2.2：批量创建额外收支（多条）
**测试编号**: TC-REV-008  
**测试目标**: 验证批量创建功能  
**请求体**: 包含 5 条不同类型的收支记录

**预期结果**:
- `successCount` = 5
- 所有记录都成功创建
- 每条记录有唯一的 `transactionNo`

---

#### 测试用例 1.2.3：创建收支记录（金额为负数）
**测试编号**: TC-REV-009  
**测试目标**: 验证金额验证规则  
**请求体**: amount = -100

**预期结果**:
- 返回状态码 400
- 错误信息: "金额必须大于0"

---

#### 测试用例 1.2.4：创建收支记录（未来日期）
**测试编号**: TC-REV-010  
**测试目标**: 验证日期验证规则  
**请求体**: transactionDate = "2027-01-01"

**预期结果**:
- 返回状态码 400
- 错误信息: "日期不能为未来日期"

---

#### 测试用例 1.2.5：创建收支记录（缺少必填字段）
**测试编号**: TC-REV-011  
**测试目标**: 验证必填字段验证  
**请求体**: 缺少 type 或 amount 或 category

**预期结果**:
- 返回状态码 400
- 错误信息提示缺少的字段

---

#### 测试用例 1.2.6：查询收支列表（无筛选）
**测试编号**: TC-REV-012  
**测试目标**: 验证列表查询功能  
**测试步骤**: GET `/api/revenue/transactions`

**预期结果**:
- 返回状态码 200
- 返回所有未删除的记录
- 包含 `summary` 统计信息
- 支持分页

---

#### 测试用例 1.2.7：查询收支列表（按类型筛选）
**测试编号**: TC-REV-013  
**测试目标**: 验证类型筛选  
**测试步骤**: GET `/api/revenue/transactions?type=expense`

**预期结果**:
- 只返回支出类型的记录
- summary 中 totalIncome = 0

---

#### 测试用例 1.2.8：查询收支列表（按日期范围筛选）
**测试编号**: TC-REV-014  
**测试目标**: 验证日期范围筛选  
**测试步骤**: GET `/api/revenue/transactions?startDate=2026-02-01&endDate=2026-02-28`

**预期结果**:
- 只返回 2月份的记录
- 边界日期包含在内

---

#### 测试用例 1.2.9：查询收支列表（关键词搜索）
**测试编号**: TC-REV-015  
**测试目标**: 验证关键词搜索  
**测试步骤**: GET `/api/revenue/transactions?keyword=租金`

**预期结果**:
- 返回描述中包含"租金"的记录
- 支持模糊匹配

---

#### 测试用例 1.2.10：删除收支记录
**测试编号**: TC-REV-016  
**测试目标**: 验证删除功能  
**测试步骤**: DELETE `/api/revenue/transactions/:id`

**预期结果**:
- 返回状态码 200
- 记录被软删除（deletedAt 不为 null）
- 后续查询不返回该记录

---

#### 测试用例 1.2.11：删除不存在的记录
**测试编号**: TC-REV-017  
**测试目标**: 验证删除异常处理  
**测试步骤**: DELETE 一个不存在的 ID

**预期结果**:
- 返回状态码 404
- 错误信息: "记录不存在"

---

### 1.3 权限控制测试

#### 测试用例 1.3.1：STAFF 角色访问收入统计
**测试编号**: TC-REV-018  
**测试目标**: 验证 STAFF 角色无权访问  
**前置条件**: 使用 STAFF Token

**测试步骤**: GET `/api/revenue/stats/today`

**预期结果**:
- 返回状态码 403
- 错误信息: "权限不足，只有老板可以访问此功能"

---

#### 测试用例 1.3.2：USER 角色访问收入统计
**测试编号**: TC-REV-019  
**测试目标**: 验证 USER 角色无权访问  
**前置条件**: 使用 USER Token

**测试步骤**: GET `/api/revenue/stats/total`

**预期结果**:
- 返回状态码 403

---

#### 测试用例 1.3.3：未登录访问
**测试编号**: TC-REV-020  
**测试目标**: 验证未授权访问  
**测试步骤**: 不携带 Token 访问任意接口

**预期结果**:
- 返回状态码 401
- 错误信息: "未授权，请先登录"

---

### 1.4 数据计算准确性测试

#### 测试用例 1.4.1：毛利率计算验证
**测试编号**: TC-REV-021  
**测试目标**: 验证毛利率计算公式  
**测试数据**:
- 订单收入: 10000
- 毛利率: 30%

**验证**:
- `grossProfit` = 3000.00
- `grossMarginRate` = 30.00

---

#### 测试用例 1.4.2：净利润计算验证（含额外收支）
**测试编号**: TC-REV-022  
**测试目标**: 验证净利润计算  
**测试数据**:
- 订单收入: 10000
- 毛利润: 3000
- 额外收入: 500
- 额外支出: 1200

**验证**:
- `netProfit` = 3000 - 1200 + 500 = 2300.00

---

#### 测试用例 1.4.3：跨月统计验证
**测试编号**: TC-REV-023  
**测试目标**: 验证月度边界处理  
**测试数据**:
- 2月28日 23:59:59 的订单
- 3月1日 00:00:00 的订单

**验证**:
- 2月统计包含 2/28 的订单
- 3月统计包含 3/1 的订单
- 不重复，不遗漏

---

#### 测试用例 1.4.4：金额精度测试
**测试编号**: TC-REV-024  
**测试目标**: 验证金额保留2位小数  
**测试数据**: 订单金额 33.333

**验证**:
- 所有金额字段保留2位小数
- 无四舍五入误差累积

---

## 2. 前端功能测试用例

### 2.1 收入统计页面测试

#### 测试用例 2.1.1：页面加载显示
**测试编号**: TC-REV-F001  
**测试目标**: 验证页面正确加载和显示  
**测试步骤**:
1. BOSS 登录系统
2. 点击"收入管理"菜单
3. 进入收入统计页面

**预期结果**:
- 显示三个数据卡片：当日/本月/总计
- 每个卡片显示完整的统计数据
- 数据格式正确（金额、百分比）

---

#### 测试用例 2.1.2：数据刷新
**测试编号**: TC-REV-F002  
**测试目标**: 验证数据刷新功能  
**测试步骤**: 点击刷新按钮

**预期结果**:
- 显示加载状态
- 数据重新请求
- 显示最新数据

---

#### 测试用例 2.1.3：日期选择器
**测试编号**: TC-REV-F003  
**测试目标**: 验证日期切换功能  
**测试步骤**: 切换查询日期或月份

**预期结果**:
- 日期选择器正常工作
- 选择后自动查询新数据
- URL参数同步更新

---

### 2.2 额外收支管理测试

#### 测试用例 2.2.1：批量录入页面显示
**测试编号**: TC-REV-F004  
**测试目标**: 验证批量录入界面  
**测试步骤**: 点击"添加额外收支"按钮

**预期结果**:
- 跳转到批量录入页面
- 显示空白表单
- "添加一行"按钮可用

---

#### 测试用例 2.2.2：添加多行记录
**测试编号**: TC-REV-F005  
**测试目标**: 验证动态添加表单行  
**测试步骤**:
1. 点击"添加一行" 3次
2. 填写 3 条不同的记录

**预期结果**:
- 显示 3 个表单项
- 每个表单独立
- 可以单独删除某一行

---

#### 测试用例 2.2.3：表单验证
**测试编号**: TC-REV-F006  
**测试目标**: 验证前端表单验证  
**测试步骤**: 提交空表单或无效数据

**预期结果**:
- 显示字段错误提示
- 金额必须大于0
- 日期不能为未来
- 必填项不能为空

---

#### 测试用例 2.2.4：批量提交成功
**测试编号**: TC-REV-F007  
**测试目标**: 验证批量提交流程  
**测试步骤**:
1. 添加 2 条有效记录
2. 点击"批量提交"

**预期结果**:
- 显示提交中状态
- 提交成功提示
- 自动返回列表页面
- 列表显示新记录

---

#### 测试用例 2.2.5：收支列表显示
**测试编号**: TC-REV-F008  
**测试目标**: 验证列表页面显示  
**测试步骤**: 进入收支列表页面

**预期结果**:
- 显示所有记录
- 收入/支出用不同颜色区分
- 显示统计摘要
- 支持分页

---

#### 测试用例 2.2.6：筛选功能
**测试编号**: TC-REV-F009  
**测试目标**: 验证筛选器功能  
**测试步骤**: 使用各种筛选条件

**预期结果**:
- 类型筛选正常
- 日期范围筛选正常
- 分类筛选正常
- 关键词搜索正常
- 统计摘要随筛选结果变化

---

#### 测试用例 2.2.10：删除记录
**测试编号**: TC-REV-F010  
**测试目标**: 验证删除功能  
**测试步骤**:
1. 点击某条记录的"删除"按钮
2. 确认删除

**预期结果**:
- 显示确认对话框
- 删除成功提示
- 记录从列表移除
- 统计数据更新

---

### 2.3 权限控制测试

#### 测试用例 2.3.1：BOSS 菜单可见性
**测试编号**: TC-REV-F011  
**测试目标**: 验证 BOSS 可见收入管理菜单  
**测试步骤**: BOSS 登录后查看菜单

**预期结果**:
- "收入管理"菜单项可见
- 可以正常点击进入

---

#### 测试用例 2.3.2：STAFF 菜单不可见
**测试编号**: TC-REV-F012  
**测试目标**: 验证 STAFF 不可见收入管理菜单  
**测试步骤**: STAFF 登录后查看菜单

**预期结果**:
- "收入管理"菜单项不可见
- 无法通过菜单进入

---

#### 测试用例 2.3.3：URL 直接访问拦截
**测试编号**: TC-REV-F013  
**测试目标**: 验证路由保护  
**测试步骤**: STAFF 直接访问 `/revenue` URL

**预期结果**:
- 显示权限不足提示
- 自动跳转到其他页面

---

## 3. 集成测试用例

### 测试用例 3.1：完整业务流程测试
**测试编号**: TC-REV-I001  
**测试目标**: 验证端到端业务流程  
**测试步骤**:
1. BOSS 登录系统
2. 查看当日收入统计
3. 录入额外支出（房租）
4. 刷新收入统计
5. 验证净利润减少

**预期结果**:
- 流程顺畅无阻塞
- 数据实时更新
- 计算结果正确

---

### 测试用例 3.2：数据一致性测试
**测试编号**: TC-REV-I002  
**测试目标**: 验证前后端数据一致性  
**测试步骤**:
1. 前端显示当日收入
2. 直接查询API获取数据
3. 对比两者数据

**预期结果**:
- 数据完全一致
- 格式化一致

---

## 4. 性能测试用例

### 测试用例 4.1：大数据量查询性能
**测试编号**: TC-REV-P001  
**测试目标**: 验证大数据量下的查询性能  
**测试数据**: 10000+ 订单记录

**预期结果**:
- 统计查询在 2 秒内完成
- 列表查询在 1 秒内完成

---

### 测试用例 4.2：批量创建性能
**测试编号**: TC-REV-P002  
**测试目标**: 验证批量创建性能  
**测试数据**: 一次性创建 50 条记录

**预期结果**:
- 创建操作在 3 秒内完成
- 数据完整无丢失

---

## 5. 测试数据准备

### 5.1 订单测试数据
```javascript
// 创建测试订单
db.orders.insertMany([
  {
    orderId: "test-order-001",
    userId: "user-001",
    dishes: [
      { dishId: ObjectId(), name: "宫保鸡丁", price: 28, quantity: 2 }
    ],
    totalPrice: 56,
    status: "completed",
    createdAt: new Date("2026-02-01T12:00:00Z")
  },
  // ... 更多订单
]);
```

### 5.2 额外收支测试数据
```javascript
// 创建测试收支记录
POST /api/revenue/transactions/batch
{
  "transactions": [
    {
      "type": "expense",
      "amount": 5000,
      "category": "房租",
      "transactionDate": "2026-02-01"
    }
  ]
}
```

## 6. 测试环境

### 6.1 测试账号
- BOSS: username="boss", password="password123"
- STAFF: username="staff", password="password123"
- USER: username="user", password="password123"

### 6.2 测试数据库
- 使用独立的测试数据库
- 每次测试前重置数据
- 保证数据隔离

## 7. 测试报告模板

### 测试执行记录
| 测试编号 | 测试项 | 测试结果 | 执行时间 | 备注 |
|---------|-------|---------|---------|-----|
| TC-REV-001 | 当日收入统计 | ✅ 通过 | 2026-02-01 | 数据正确 |
| TC-REV-002 | 指定日期统计 | ✅ 通过 | 2026-02-01 | - |
| ... | ... | ... | ... | ... |

### 缺陷记录
| 缺陷ID | 严重程度 | 描述 | 状态 | 修复时间 |
|-------|---------|-----|------|---------|
| BUG-001 | 高 | 净利润计算错误 | 已修复 | 2026-02-01 |
| ... | ... | ... | ... | ... |

## 8. 验收标准

- ✅ 所有 API 测试用例通过率 100%
- ✅ 所有前端功能测试用例通过率 100%
- ✅ 权限控制测试通过

---

## 9. 精确成本核算专项测试

### 测试用例 9.1：菜品绑定食材成本计算
**测试编号**: TC-REV-COST-001  
**测试目标**: 验证系统正确计算菜品绑定食材的成本  
**前置条件**: 
- 库存中有食材：鸡肉(¥20/份)、花生(¥8/份)、辣椒(¥5/份)
- 菜品"宫保鸡丁"绑定了以上3种食材
- 菜品售价¥48

**测试步骤**:
1. 创建订单包含1份宫保鸡丁
2. 订单完成后查询当日统计

**预期结果**:
- `revenue` = 48
- `materialCost` = 20 + 8 + 5 = 33
- `grossProfit` = 48 - 33 = 15
- `grossMarginRate` = (15 / 48) × 100 = 31.25%

---

### 测试用例 9.2：多数量菜品成本计算
**测试编号**: TC-REV-COST-002  
**测试目标**: 验证相同菜品多份的成本计算  
**前置条件**: 宫保鸡丁成本¥33/份

**测试步骤**:
1. 创建订单包含3份宫保鸡丁（¥48 × 3 = ¥144）
2. 订单完成后查询统计

**预期结果**:
- `materialCost` = 33 × 3 = 99
- `grossProfit` = 144 - 99 = 45

---

### 测试用例 9.3：未绑定食材的菜品
**测试编号**: TC-REV-COST-003  
**测试目标**: 验证未绑定食材的菜品成本为0  
**前置条件**: 菜品"特色饮料"未绑定任何食材，售价¥15

**测试步骤**:
1. 创建订单包含1份特色饮料
2. 订单完成后查询统计

**预期结果**:
- `revenue` = 15
- `materialCost` = 0（该菜品无绑定食材）
- `grossProfit` = 15
- `grossMarginRate` = 100%

---

### 测试用例 9.4：混合订单成本计算
**测试编号**: TC-REV-COST-004  
**测试目标**: 验证包含多个菜品的订单成本计算  
**前置条件**: 
- 宫保鸡丁：售价¥48，成本¥33
- 特色饮料：售价¥15，成本¥0

**测试步骤**:
1. 创建订单：2份宫保鸡丁 + 1份特色饮料
2. 订单完成后查询统计

**预期结果**:
- `revenue` = 48 × 2 + 15 = 111
- `materialCost` = 33 × 2 + 0 = 66
- `grossProfit` = 111 - 66 = 45
- `grossMarginRate` = (45 / 111) × 100 ≈ 40.54%

---

### 测试用例 9.5：食材价格变动影响
**测试编号**: TC-REV-COST-005  
**测试目标**: 验证食材价格变动后成本计算  
**前置条件**: 鸡肉价格从¥20调整为¥25

**测试步骤**:
1. 更新库存中鸡肉的最新价格为¥25
2. 创建新订单包含1份宫保鸡丁
3. 查询统计

**预期结果**:
- `materialCost` = 25 + 8 + 5 = 38（使用最新价格）
- `grossProfit` = 48 - 38 = 10
- `grossMarginRate` = (10 / 48) × 100 ≈ 20.83%

---

### 测试用例 9.6：跨日期成本统计
**测试编号**: TC-REV-COST-006  
**测试目标**: 验证月度和总体统计的成本累加  
**前置条件**: 
- 2月1日：订单收入¥200，实际成本¥120
- 2月2日：订单收入¥300，实际成本¥180

**测试步骤**:
1. 查询2月份月度统计

**预期结果**:
- `revenue` = 200 + 300 = 500
- `materialCost` = 120 + 180 = 300
- `grossProfit` = 500 - 300 = 200
- `grossMarginRate` = (200 / 500) × 100 = 40%

---

### 测试用例 9.7：食材已删除的菜品
**测试编号**: TC-REV-COST-007  
**测试目标**: 验证绑定食材被软删除后的处理  
**前置条件**: 
- 菜品绑定了食材A(已删除)和食材B(¥10)

**测试步骤**:
1. 创建包含该菜品的订单
2. 查询统计

**预期结果**:
- `materialCost` = 10（仅计算未删除的食材）
- 系统日志记录警告信息
- 不影响统计正常运行

---

## 10. 成本核算公式验证

### 核心公式
```
毛利额 = 销售收入 - 销售成本
毛利率 = (毛利额 ÷ 销售收入) × 100%
销售成本 = Σ(菜品成本 × 菜品数量)
菜品成本 = Σ(绑定食材的最新进货价格)
总成本 = 销售成本 + 额外支出
净利润 = 毛利额 - 额外支出 + 额外收入
```

### 验证方法
1. 手动计算预期值
2. 调用API获取实际值
3. 对比误差 < 0.01元

---

## 11. 性能测试

### 测试用例 11.1：大量订单成本计算性能
**测试编号**: TC-REV-PERF-001  
**测试目标**: 验证系统在处理大量订单时的性能  
**测试数据**: 1000个已完成订单，每个订单包含3-5个菜品

**测试步骤**:
1. 查询总体收入统计
2. 记录响应时间

**预期结果**:
- 响应时间 < 5秒
- 成本计算准确
- 无内存泄漏

---

### 测试用例 11.2：并发查询测试
**测试编号**: TC-REV-PERF-002  
**测试目标**: 验证多用户并发查询统计  
**测试步骤**: 10个BOSS用户同时查询当日统计

**预期结果**:
- 所有请求成功返回
- 数据一致性
- 平均响应时间 < 2秒
- ✅ 数据计算准确无误
- ✅ 性能满足要求
- ✅ 无严重或高危缺陷
---

## 12. 前端UI布局测试

### 测试用例 12.1：收入统计卡片Grid布局展示
**测试编号**: TC-REV-UI-001  
**测试目标**: 验证stat-item使用grid布局正确展示  
**前置条件**: 
- 使用BOSS账号登录
- 系统有统计数据

**测试步骤**:
1. 进入收入统计页面
2. 查看当日/月度/总体统计卡片中的stat-item布局
3. 检查标签和数值的对齐方式

**预期结果**:
- ✅ stat-item使用grid布局（grid-template-columns: 1fr auto）
- ✅ 标签（stat-label）左对齐显示
- ✅ 数值（stat-value）右对齐显示
- ✅ 标签和数值之间有合理的间距（gap: 12px）
- ✅ 各个stat-item之间垂直排列整齐
- ✅ 高亮项（highlighted）保持grid布局

---

### 测试用例 12.2：响应式布局验证
**测试编号**: TC-REV-UI-002  
**测试目标**: 验证不同屏幕尺寸下grid布局表现  
**测试步骤**:
1. 在移动设备上打开收入统计页面（375px宽度）
2. 在平板设备上打开（768px宽度）
3. 在桌面浏览器上打开（1024px宽度）

**预期结果**:
- ✅ 所有尺寸下stat-item grid布局正常工作
- ✅ 标签和数值对齐一致
- ✅ 无文字溢出或重叠
- ✅ 视觉效果美观

---

### 测试用例 12.3：长文本和大数值显示
**测试编号**: TC-REV-UI-003  
**测试目标**: 验证极端数据下的布局表现  
**前置条件**: 系统有大额收入数据（如：¥1,234,567.89）

**测试步骤**:
1. 查看包含大额数值的统计卡片
2. 检查布局是否保持正常

**预期结果**:
- ✅ grid布局自动适应数值宽度
- ✅ 标签和数值不换行
- ✅ 整体布局不变形
- ✅ 数值完整显示

---

### 测试用例 12.4：高亮项布局验证
**测试编号**: TC-REV-UI-004  
**测试目标**: 验证净利润高亮项的grid布局  
**测试步骤**:
1. 查看统计卡片中的净利润行（highlighted）
2. 检查高亮背景和grid布局的配合

**预期结果**:
- ✅ 高亮项使用grid布局（grid-template-columns: 1fr auto）
- ✅ 背景渐变效果正常显示
- ✅ padding和margin不影响grid对齐
- ✅ 标签和数值在高亮区域内正确对齐

---

## 13. 国际化功能测试用例

### 13.1 收入管理页面国际化

#### 测试用例 13.1.1：收入统计页面中英文切换
**测试编号**: TC-REV-I18N-001  
**测试目标**: 验证收入统计页面支持中英文切换  
**前置条件**: 
- 系统支持语言切换功能
- 收入统计页面已加载

**测试步骤**:
1. 进入收入统计页面（默认中文）
2. 切换到英文语言
3. 切换回中文语言
4. 检查所有文本显示是否正确

**预期结果**:
- ✅ 页面标题正确切换："收入统计" ↔ "Revenue Statistics"
- ✅ 操作按钮正确切换："管理额外收支" ↔ "Manage Extra Revenue", "刷新数据" ↔ "Refresh Data"
- ✅ 统计标题正确切换："当日数据" ↔ "Daily Data", "月度数据" ↔ "Monthly Data", "总体数据" ↔ "Overall Data"
- ✅ 数据标签正确切换："营业收入" ↔ "Operating Income", "总成本" ↔ "Total Cost", "毛利润" ↔ "Gross Profit", "毛利率" ↔ "Gross Margin", "净利润" ↔ "Net Profit"
- ✅ 额外项目正确切换："额外收入" ↔ "Extra Income", "额外支出" ↔ "Extra Expense", "订单数量" ↔ "Order Count"
- ✅ 日期选择正确切换："选择日期" ↔ "Select Date", "选择月份" ↔ "Select Month"
- ✅ 布局在两种语言下保持稳定，无换行或变形

---

#### 测试用例 13.1.2：额外收支管理页面中英文切换
**测试编号**: TC-REV-I18N-002  
**测试目标**: 验证额外收支管理页面支持中英文切换  
**前置条件**: 
- 系统支持语言切换功能
- 额外收支管理页面已加载

**测试步骤**:
1. 进入额外收支管理页面（默认中文）
2. 切换到英文语言
3. 切换回中文语言
4. 检查所有文本显示是否正确

**预期结果**:
- ✅ 页面标题正确切换："额外收支管理" ↔ "Extra Revenue Management"
- ✅ 筛选器正确切换："类型" ↔ "Type", "收入" ↔ "Income", "支出" ↔ "Expense"
- ✅ 汇总信息正确切换："收入总额" ↔ "Total Income", "支出总额" ↔ "Total Expense"
- ✅ 列表项信息正确切换：类型显示"收入/支出" ↔ "Income/Expense"
- ✅ 确认对话框正确切换："确定要删除这条收入/支出记录吗？" ↔ "Confirm to delete this income/expense record?"
- ✅ 布局在两种语言下保持稳定

---

#### 测试用例 13.1.3：批量创建交易记录页面中英文切换
**测试编号**: TC-REV-I18N-003  
**测试目标**: 验证批量创建交易记录页面支持中英文切换  
**前置条件**: 
- 系统支持语言切换功能
- 批量创建交易记录页面已加载

**测试步骤**:
1. 进入批量创建交易记录页面（默认中文）
2. 切换到英文语言
3. 切换回中文语言
4. 检查所有文本显示是否正确

**预期结果**:
- ✅ 页面标题正确切换："批量创建收支记录" ↔ "Batch Create Transactions"
- ✅ 卡片标题正确切换："记录 1" ↔ "Record 1"
- ✅ 表单标签正确切换："类型" ↔ "Type", "金额（元）" ↔ "Amount (¥)", "分类" ↔ "Category", "日期" ↔ "Date", "描述（可选）" ↔ "Description (Optional)"
- ✅ 类型选择正确切换："收入" ↔ "Income", "支出" ↔ "Expense"
- ✅ 分类选项正确切换：支出分类"房租,水电费,人工工资..." ↔ "Rent,Utilities,Labor Cost...", 收入分类"政府补贴,设备租赁收入..." ↔ "Government Subsidy,Equipment Rental Income..."
- ✅ 占位符文本正确切换："请输入金额" ↔ "Enter amount", "详细描述这笔收支..." ↔ "Describe this transaction..."
- ✅ 按钮文本正确切换："选择分类" ↔ "Select Category", "批量提交 (X 条)" ↔ "Batch Submit (X records)", "添加一行" ↔ "Add Row"
- ✅ 验证信息正确切换："第1条: 金额必须大于0" ↔ "Record 1: Amount must be greater than 0", "第1条: 请填写分类" ↔ "Record 1: Please fill in category"
- ✅ 确认信息正确切换："确定要提交 X 条记录吗？" ↔ "Confirm to submit X records?"

---

#### 测试用例 13.1.4：额外收入列表录入时间国际化
**测试编号**: TC-REV-I18N-004  
**测试目标**: 验证额外收入列表的“录入时间”在中英文环境下格式正确  
**前置条件**: 
- 系统支持语言切换功能
- 额外收支管理页面存在额外收入记录

**测试步骤**:
1. 进入额外收支管理页面并筛选为“收入”类型
2. 在中文模式下查看列表中的“录入时间”字段
3. 切换到英文模式再次查看“录入时间”字段
4. 验证时间格式是否符合对应语言习惯

**预期结果**:
- ✅ 中文环境：显示格式 "YYYY-MM-DD HH:mm" (如: 2026-02-06 14:30)
- ✅ 英文环境：显示格式 "MMM DD, YYYY HH:mm" (如: Feb 06, 2026 14:30)
- ✅ 语言切换后无需刷新即可更新显示
- ✅ 时间字段布局稳定，不出现换行或变形

---

#### 测试用例 13.1.5：国际化错误信息显示
**测试编号**: TC-REV-I18N-005  
**测试目标**: 验证错误信息和Toast提示支持中英文  
**前置条件**: 
- 系统支持语言切换功能

**测试步骤**:
1. 在中文模式下触发各种错误场景（如API失败、表单验证失败等）
2. 切换到英文模式重复相同操作
3. 验证错误信息是否正确显示

**预期结果**:
- ✅ API错误信息正确切换：如"查询当日数据失败" ↔ "Failed to load daily data"  
- ✅ 表单验证错误正确切换：如"至少保留一条记录" ↔ "Keep at least one record"
- ✅ 成功信息正确切换：如"提交成功" ↔ "Submit successful"
- ✅ 删除确认信息正确切换（在对话框中使用正确的语言）

---

#### 测试用例 13.1.6：批量创建页面数量提示国际化
**测试编号**: TC-REV-I18N-006  
**测试目标**: 验证批量创建交易记录页面的数量提示支持中英文  
**前置条件**: 
- 系统支持语言切换功能
- 批量创建交易记录页面已加载

**测试步骤**:
1. 进入批量创建交易记录页面（默认中文）
2. 添加多条记录，观察顶部数量提示
3. 切换到英文语言
4. 再次观察顶部数量提示

**预期结果**:
- ✅ 中文环境显示："共 X 条"
- ✅ 英文环境显示："Total X records"
- ✅ 记录数量变化时提示文本实时更新

---

#### 测试用例 13.1.7：分页信息与加载更多国际化
**测试编号**: TC-REV-I18N-008  
**测试目标**: 验证额外收支管理分页信息与“加载更多”支持中英文  
**前置条件**: 
- 系统支持语言切换功能
- 额外收支管理页面有多页数据

**测试步骤**:
1. 进入额外收支管理页面（默认中文）
2. 观察分页信息与“加载更多”按钮文本
3. 切换到英文语言
4. 再次观察分页信息与“加载更多”按钮文本

**预期结果**:
- ✅ 中文环境显示分页信息："共 X 条记录，第 Y / Z 页"
- ✅ 中文环境按钮显示：“加载更多”
- ✅ 英文环境显示分页信息："Total X records, page Y / Z"
- ✅ 英文环境按钮显示：“Load more”
- ✅ 切换语言后无需刷新即可更新显示

---

### 13.2 国际化布局稳定性测试

#### 测试用例 13.2.1：切换语言后布局保持稳定
**测试编号**: TC-REV-I18N-007  
**测试目标**: 验证中英文切换后页面布局不变形  
**测试步骤**:
1. 在中文模式下加载收入管理的所有页面
2. 记录各元素的布局位置
3. 切换到英文模式
4. 对比布局变化

**预期结果**:
- ✅ 统计卡片高度保持一致
- ✅ 按钮宽度自适应文本长度，但不超出容器
- ✅ 表单项标签宽度保持一致
- ✅ 列表项高度保持一致
- ✅ 不出现文本截断或换行问题（除了设计要求的省略）
- ✅ 不影响页面的scroll行为

---

#### 测试用例 13.2.2：响应式布局与国际化兼容性
**测试编号**: TC-REV-I18N-007  
**测试目标**: 验证在不同屏幕尺寸下国际化表现正常  
**测试步骤**:
1. 在不同屏幕宽度（320px, 375px, 414px）下测试
2. 分别在中英文模式下查看
3. 验证布局和文本显示

**预期结果**:
- ✅ 小屏幕下长英文单词不会超出容器
- ✅ Grid布局在不同语言下均能正确对齐
- ✅ 按钮和表单组件在窄屏下文本不会被截断
- ✅ 统计数据的标签和数值在各种屏幕宽度下保持对齐

---