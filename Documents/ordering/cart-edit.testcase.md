# 购物车编辑功能测试用例

## 功能概述
本功能允许用户在AI推荐菜品后或主动浏览菜单时，编辑购物车中的菜品数量，并将更新同步到后端。

## 测试环境
- 前端：http://localhost:3000
- 后端：http://localhost:3001
- 测试账号：任意注册用户

---

## 测试用例1：AI推荐菜后编辑购物车

### 测试步骤
1. 登录系统，进入智能点餐页面
2. 输入点餐需求，例如："我想吃辣的，预算100元"
3. AI返回推荐菜单后，点击菜单卡片打开编辑页面
4. 查看菜单列表中是否已显示推荐的菜品数量
5. 修改某些菜品的数量（增加/减少/删除）
6. 点击"确认选择"按钮

### 预期结果
- ✅ 打开菜单列表时，推荐的菜品数量已自动填充到Stepper中
- ✅ 修改数量后，总价实时更新
- ✅ 点击确认后，显示"购物车已更新"提示
- ✅ 购物车数据成功同步到后端

### 验证方法
```bash
# 查看购物车内容
curl -X GET http://localhost:3001/api/ordering/cart \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 测试用例2：主动浏览菜单编辑购物车

### 测试步骤
1. 登录系统，进入智能点餐页面
2. 点击右上角菜单图标（UnorderedListOutline）打开菜单列表
3. 如果之前有添加过菜品，查看是否显示购物车中的数量
4. 浏览不同分类，选择新的菜品或修改已有菜品数量
5. 点击"确认选择"按钮

### 预期结果
- ✅ 打开菜单时，如果购物车有内容，相应菜品的数量已填充
- ✅ 侧边栏分类上显示该分类已选菜品的数量徽章
- ✅ 修改数量后，底部总价实时更新
- ✅ 确认后购物车成功更新到后端

### 验证方法
```bash
# 查看购物车内容
curl -X GET http://localhost:3001/api/ordering/cart \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 测试用例3：购物车数据持久化

### 测试步骤
1. 在菜单中选择若干菜品，确认选择
2. 刷新页面或重新进入点餐页面
3. 点击菜单图标打开菜单列表
4. 查看之前选择的菜品数量是否仍然存在

### 预期结果
- ✅ 购物车数据在刷新后仍然保留
- ✅ 打开菜单时，之前选择的菜品数量正确显示

---

## 测试用例4：购物车编辑后创建订单

### 测试步骤
1. 在菜单中选择菜品并确认（购物车已更新）
2. 在聊天界面发送："确认下单"
3. 系统创建订单

### 预期结果
- ✅ 订单中包含购物车中的所有菜品
- ✅ 订单总价与购物车总价一致
- ✅ 订单创建成功后，购物车被清空

### 验证方法
```bash
# 查看订单列表
curl -X GET "http://localhost:3001/api/ordering/my-orders?page=1&limit=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## 测试用例5：购物车编辑API直接测试

### 测试步骤
使用curl直接测试购物车编辑API

### 测试命令
```bash
# 1. 获取菜品列表（获取dishId）
curl -X GET http://localhost:3001/api/dish

# 2. 更新购物车
curl -X PUT http://localhost:3001/api/ordering/cart \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "dishes": [
      {"dishId": "507f1f77bcf86cd799439011", "quantity": 2},
      {"dishId": "507f1f77bcf86cd799439012", "quantity": 1}
    ]
  }'

# 3. 获取购物车验证
curl -X GET http://localhost:3001/api/ordering/cart \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 预期结果
- ✅ 返回状态码200
- ✅ 返回更新后的购物车数据
- ✅ dishes数组包含指定的菜品和数量
- ✅ totalPrice计算正确

---

## 测试用例6：边界情况测试

### 6.1 空购物车
**测试步骤：**
- 清空所有菜品后确认选择

**预期结果：**
- ✅ 提示"请选择菜品"

### 6.2 数量为0
**测试步骤：**
- 将某个菜品数量设置为0

**预期结果：**
- ✅ 该菜品从购物车中移除

### 6.3 网络错误
**测试步骤：**
- 断开网络连接后尝试更新购物车

**预期结果：**
- ✅ 显示"更新购物车失败，请重试"提示
- ✅ 页面不崩溃，购物车状态保持不变

---

## 回归测试清单

- [ ] AI推荐菜功能仍然正常工作
- [ ] 刷新菜单功能仍然正常工作
- [ ] 创建订单功能仍然正常工作
- [ ] 聊天历史记录显示正常
- [ ] 菜单分类切换正常
- [ ] 菜品搜索功能正常（如果有）
- [ ] 食材库存检查功能正常

---

## 性能测试

### 测试场景
- 购物车包含50个菜品时的加载速度
- 快速连续修改菜品数量的响应速度

### 预期结果
- ✅ 打开菜单列表耗时 < 1秒
- ✅ 修改数量后UI立即响应
- ✅ 提交购物车更新耗时 < 2秒

---

## 已知问题
无

---

## 测试完成标准
- [ ] 所有测试用例通过
- [ ] 无明显性能问题
- [ ] 无UI显示异常
- [ ] 数据一致性验证通过
