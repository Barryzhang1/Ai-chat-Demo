# 订单状态流转前端功能测试用例

## 测试概述

本文档提供订单状态流转前端功能的详细测试用例，包括UI显示、用户交互、API调用和异常处理等方面。

## 测试环境

- **前端应用**：ChatUI (React + antd-mobile)
- **后端服务**：ChatBackEnd (NestJS)
- **数据库**：MongoDB
- **浏览器**：Chrome/Safari (移动端模式)
- **测试工具**：手动测试 + 浏览器开发者工具

## 功能测试用例

### 用例组1：订单按钮显示

#### TC-001：待接单订单显示接单按钮

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 后端服务正常运行
2. 数据库中存在status为`pending`的订单
3. 商家账号已登录

**测试步骤**：
1. 访问商家后台订单列表页面（`/merchant/orders`）
2. 点击"待接单"标签
3. 查看订单列表中的订单卡片

**预期结果**：
- ✅ 每个订单卡片右下角显示蓝色"接单"按钮
- ✅ 按钮文字为"接单"
- ✅ 按钮尺寸为small
- ✅ 按钮颜色为primary（蓝色）
- ✅ 订单状态标签显示"待制作"，颜色为橙色

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-002：制作中订单显示完成制作按钮

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 后端服务正常运行
2. 数据库中存在status为`preparing`的订单
3. 商家账号已登录

**测试步骤**：
1. 访问商家后台订单列表页面
2. 点击"制作中"标签
3. 查看订单列表中的订单卡片

**预期结果**：
- ✅ 每个订单卡片右下角显示绿色"完成制作"按钮
- ✅ 按钮文字为"完成制作"
- ✅ 按钮尺寸为small
- ✅ 按钮颜色为success（绿色）
- ✅ 订单状态标签显示"制作中"，颜色为蓝色

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-003：已完成订单不显示操作按钮

**优先级**：中  
**测试类型**：功能测试

**前置条件**：
1. 后端服务正常运行
2. 数据库中存在status为`completed`的订单
3. 商家账号已登录

**测试步骤**：
1. 访问商家后台订单列表页面
2. 点击"已完成"标签
3. 查看订单列表中的订单卡片右下角

**预期结果**：
- ✅ 订单卡片右下角不显示任何操作按钮
- ✅ 只显示状态标签"已完成"（灰色）
- ✅ 显示订单总价
- ✅ 布局正常，无空白按钮占位

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-004：已取消订单不显示操作按钮

**优先级**：低  
**测试类型**：功能测试

**前置条件**：
1. 数据库中存在status为`cancelled`的订单
2. 商家账号已登录

**测试步骤**：
1. 访问订单列表页面
2. 点击"全部订单"标签
3. 查找已取消状态的订单

**预期结果**：
- ✅ 订单卡片右下角不显示操作按钮
- ✅ 状态标签显示"已取消"（红色）
- ✅ 布局正常

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

### 用例组2：订单状态更新

#### TC-005：成功接单（pending → preparing）

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 存在pending状态的测试订单
2. 商家已登录，Token有效
3. 后端服务正常运行

**测试步骤**：
1. 进入"待接单"标签页
2. 点击某订单的"接单"按钮
3. 在弹出的确认对话框中查看提示内容
4. 点击"确认"按钮
5. 等待请求完成
6. 观察页面变化

**预期结果**：
- ✅ 弹出确认对话框，内容为"确认将订单状态改为'制作中'吗？"
- ✅ 显示Toast提示"订单状态已更新"
- ✅ 订单列表自动刷新
- ✅ 该订单从"待接单"列表中消失
- ✅ 切换到"制作中"标签，可以看到该订单
- ✅ 订单状态标签变为"制作中"（蓝色）
- ✅ 订单右下角显示"完成制作"按钮
- ✅ Network面板显示PATCH请求成功（200）

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-006：成功完成制作（preparing → completed）

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 存在preparing状态的测试订单
2. 商家已登录
3. 后端服务正常运行

**测试步骤**：
1. 进入"制作中"标签页
2. 点击某订单的"完成制作"按钮
3. 查看确认对话框
4. 点击"确认"
5. 等待请求完成
6. 观察页面变化

**预期结果**：
- ✅ 弹出确认对话框，内容为"确认将订单状态改为'已完成'吗？"
- ✅ 显示Toast提示"订单状态已更新"
- ✅ 订单从"制作中"列表消失
- ✅ 切换到"已完成"标签，可以看到该订单
- ✅ 订单状态标签变为"已完成"（灰色）
- ✅ 订单右下角不显示任何按钮
- ✅ Network面板显示PATCH请求成功（200）

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-007：取消确认对话框

**优先级**：中  
**测试类型**：功能测试

**前置条件**：
1. 存在pending状态的订单
2. 商家已登录

**测试步骤**：
1. 进入"待接单"标签页
2. 点击"接单"按钮
3. 在确认对话框中点击"取消"或点击对话框外部区域
4. 观察页面状态

**预期结果**：
- ✅ 确认对话框关闭
- ✅ 订单状态不变，仍为pending
- ✅ "接单"按钮仍然可见
- ✅ Network面板无PATCH请求发送
- ✅ 无Toast提示

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

### 用例组3：订单筛选功能

#### TC-008：全部订单标签页显示所有状态订单

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 数据库中存在不同状态的订单（pending, preparing, completed）
2. 商家已登录

**测试步骤**：
1. 访问订单列表页面
2. 点击"全部订单"标签
3. 查看订单列表

**预期结果**：
- ✅ 显示所有状态的订单
- ✅ 包括pending、preparing、completed、cancelled状态的订单
- ✅ 订单按创建时间倒序排列（最新的在上面）
- ✅ Network面板请求参数不包含status过滤

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-009：待接单标签页仅显示pending订单

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 数据库中存在不同状态的订单
2. 商家已登录

**测试步骤**：
1. 点击"待接单"标签
2. 查看订单列表
3. 检查Network面板请求参数

**预期结果**：
- ✅ 只显示status为`pending`的订单
- ✅ 不显示其他状态的订单
- ✅ 所有订单右下角显示"接单"按钮
- ✅ Network请求包含参数`status=pending`

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-010：制作中标签页仅显示preparing订单

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 数据库中存在不同状态的订单
2. 商家已登录

**测试步骤**：
1. 点击"制作中"标签
2. 查看订单列表
3. 检查Network面板请求参数

**预期结果**：
- ✅ 只显示status为`preparing`的订单
- ✅ 不显示其他状态的订单
- ✅ 所有订单右下角显示"完成制作"按钮
- ✅ Network请求包含参数`status=preparing`

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-011：已完成标签页仅显示completed订单

**优先级**：高  
**测试类型**：功能测试

**前置条件**：
1. 数据库中存在不同状态的订单
2. 商家已登录

**测试步骤**：
1. 点击"已完成"标签
2. 查看订单列表
3. 检查Network面板请求参数

**预期结果**：
- ✅ 只显示status为`completed`的订单
- ✅ 不显示其他状态的订单
- ✅ 订单右下角不显示操作按钮
- ✅ Network请求包含参数`status=completed`

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-012：切换标签页自动刷新

**优先级**：中  
**测试类型**：功能测试

**前置条件**：
1. 商家已登录
2. 数据库中有多个状态的订单

**测试步骤**：
1. 进入"待接单"标签
2. 等待订单加载完成
3. 依次切换到"制作中"、"已完成"、"全部订单"标签
4. 观察Network面板请求

**预期结果**：
- ✅ 每次切换标签都会发送新的API请求
- ✅ 订单列表重新加载
- ✅ 页码重置为1
- ✅ 加载状态正确显示
- ✅ 请求参数中的status值正确变化

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

### 用例组4：异常处理

#### TC-013：网络错误处理

**优先级**：高  
**测试类型**：异常测试

**前置条件**：
1. 商家已登录
2. 存在pending订单

**测试步骤**：
1. 打开浏览器开发者工具Network标签
2. 设置网络为Offline（离线模式）
3. 点击"接单"按钮
4. 确认对话框中点击"确认"
5. 观察页面反应

**预期结果**：
- ✅ 显示Toast错误提示"更新失败，请重试"
- ✅ 订单状态不变
- ✅ 订单列表不刷新
- ✅ "接单"按钮仍然可见
- ✅ 控制台输出错误日志

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-014：后端服务不可用

**优先级**：高  
**测试类型**：异常测试

**前置条件**：
1. 商家已登录
2. 后端服务已停止

**测试步骤**：
1. 停止后端服务
2. 点击"接单"按钮并确认
3. 观察错误处理

**预期结果**：
- ✅ 显示错误提示
- ✅ 订单状态不变
- ✅ 应用不崩溃
- ✅ 控制台显示网络错误

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-015：JWT Token过期

**优先级**：高  
**测试类型**：异常测试

**前置条件**：
1. 商家已登录但Token已过期
2. 存在pending订单

**测试步骤**：
1. 手动修改localStorage中的token为过期token
2. 点击"接单"按钮并确认
3. 观察响应

**预期结果**：
- ✅ 后端返回401 Unauthorized
- ✅ 前端显示错误提示
- ✅ 建议：应该跳转到登录页面（需要实现）

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-016：订单不存在

**优先级**：中  
**测试类型**：异常测试

**前置条件**：
1. 商家已登录

**测试步骤**：
1. 在浏览器控制台手动调用API，传入不存在的orderId
   ```javascript
   orderApi.updateOrderStatus('invalid-order-id', 'preparing')
   ```
2. 观察响应

**预期结果**：
- ✅ 后端返回404 Not Found
- ✅ 显示错误提示"订单不存在"
- ✅ 不刷新订单列表

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-017：无权限修改订单

**优先级**：中  
**测试类型**：异常测试

**前置条件**：
1. 用户A已登录
2. 存在用户B创建的订单

**测试步骤**：
1. 尝试修改不属于当前用户的订单状态
2. 观察后端响应

**预期结果**：
- ✅ 后端返回400 Bad Request
- ✅ 错误信息"无权限修改此订单"
- ✅ 前端显示错误提示
- ✅ 订单状态不变

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

### 用例组5：UI/UX测试

#### TC-018：按钮点击反馈

**优先级**：中  
**测试类型**：UI测试

**前置条件**：
1. 存在pending或preparing订单
2. 商家已登录

**测试步骤**：
1. 点击"接单"或"完成制作"按钮
2. 观察按钮状态变化

**预期结果**：
- ✅ 按钮有点击反馈效果（颜色变化）
- ✅ 点击后立即弹出确认对话框
- ✅ 用户体验流畅

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-019：移动端适配

**优先级**：高  
**测试类型**：UI测试

**前置条件**：
1. 使用移动端设备或浏览器移动端模式

**测试步骤**：
1. 在不同尺寸的移动设备上访问订单列表
2. 查看按钮显示和布局
3. 测试触摸操作

**预期结果**：
- ✅ 按钮大小适合手指点击（至少44x44px）
- ✅ 布局在小屏幕上不错乱
- ✅ 文字清晰可读
- ✅ 触摸操作灵敏

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-020：Loading状态显示

**优先级**：中  
**测试类型**：UI测试

**前置条件**：
1. 商家已登录
2. 网络速度较慢（可使用浏览器Network throttling模拟）

**测试步骤**：
1. 在Network标签设置"Slow 3G"
2. 点击"接单"按钮并确认
3. 观察更新过程

**预期结果**：
- ✅ 显示Loading状态（建议：按钮禁用或显示加载动画）
- ✅ 用户知道操作正在进行中
- ✅ 防止重复点击

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-021：Toast提示可见性

**优先级**：中  
**测试类型**：UI测试

**前置条件**：
1. 成功更新订单状态

**测试步骤**：
1. 点击"接单"并确认
2. 观察Toast提示

**预期结果**：
- ✅ Toast提示清晰可见
- ✅ 提示内容准确（成功/失败）
- ✅ 提示自动消失（2-3秒）
- ✅ 提示位置合理（不遮挡重要内容）

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

### 用例组6：性能测试

#### TC-022：大量订单加载性能

**优先级**：中  
**测试类型**：性能测试

**前置条件**：
1. 数据库中有100+订单
2. 商家已登录

**测试步骤**：
1. 访问订单列表页面
2. 观察加载时间
3. 测试下拉刷新和无限滚动

**预期结果**：
- ✅ 首屏订单加载时间 < 2秒
- ✅ 下拉刷新流畅
- ✅ 无限滚动加载无卡顿
- ✅ 内存占用合理

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

#### TC-023：快速切换标签性能

**优先级**：低  
**测试类型**：性能测试

**前置条件**：
1. 商家已登录
2. 有多个状态的订单

**测试步骤**：
1. 快速连续切换标签页
2. 观察应用响应

**预期结果**：
- ✅ 应用不崩溃
- ✅ 请求正确处理（取消旧请求或忽略旧响应）
- ✅ 显示最新标签的数据
- ✅ 无明显卡顿

**实际结果**：_（测试时填写）_

**测试状态**：□ 通过 □ 失败 □ 阻塞

---

## 集成测试场景

### 场景1：完整的订单流转流程

**测试步骤**：
1. 用户创建订单（通过用户端点餐）
2. 商家在"待接单"看到新订单
3. 商家点击"接单"
4. 订单移动到"制作中"
5. 商家点击"完成制作"
6. 订单移动到"已完成"

**预期结果**：
- ✅ 整个流程顺畅无误
- ✅ 每个步骤状态更新及时
- ✅ UI显示正确

---

### 场景2：并发订单处理

**测试步骤**：
1. 同时有3个新订单到达
2. 商家快速接单
3. 观察系统表现

**预期结果**：
- ✅ 所有订单正确更新
- ✅ 无状态冲突
- ✅ UI正确刷新

---

## 测试数据准备

### 创建测试订单脚本

```javascript
// 在浏览器控制台执行
async function createTestOrder(status) {
  const orderData = {
    dishes: [
      { dishId: '507f1f77bcf86cd799439011', name: '宫保鸡丁', price: 38, quantity: 1 }
    ],
    totalPrice: 38,
    note: `测试订单 - ${status}`
  };
  
  const res = await fetch('http://localhost:3001/api/ordering/create-order', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    },
    body: JSON.stringify(orderData)
  });
  
  const data = await res.json();
  console.log('订单创建成功:', data);
  
  // 如果需要修改状态
  if (status !== 'pending') {
    await fetch(`http://localhost:3001/api/ordering/orders/${data.data.orderId}/status`, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify({ status })
    });
  }
}

// 使用示例
await createTestOrder('pending');    // 创建待接单订单
await createTestOrder('preparing');  // 创建制作中订单
await createTestOrder('completed');  // 创建已完成订单
```

## 测试报告模板

### 测试执行摘要

| 项目 | 值 |
|------|-----|
| 测试执行日期 | YYYY-MM-DD |
| 测试执行人 | XXX |
| 测试用例总数 | 23 |
| 通过用例数 | - |
| 失败用例数 | - |
| 阻塞用例数 | - |
| 通过率 | - % |

### 缺陷统计

| 缺陷级别 | 数量 | 描述 |
|----------|------|------|
| 严重 | - | - |
| 一般 | - | - |
| 轻微 | - | - |

### 测试结论

_（填写测试结论和建议）_

## 回归测试清单

每次代码修改后，至少执行以下核心用例：

- [ ] TC-001：待接单订单显示接单按钮
- [ ] TC-002：制作中订单显示完成制作按钮
- [ ] TC-005：成功接单
- [ ] TC-006：成功完成制作
- [ ] TC-009：待接单标签页筛选
- [ ] TC-010：制作中标签页筛选
- [ ] TC-011：已完成标签页筛选
- [ ] TC-013：网络错误处理

## 自动化测试建议

### 推荐使用的测试框架
- **单元测试**：Jest + React Testing Library
- **E2E测试**：Cypress或Playwright
- **API测试**：Jest + Supertest

### 优先自动化的用例
1. TC-005：成功接单流程
2. TC-006：成功完成制作流程
3. TC-009-011：标签页筛选功能
4. TC-013：网络错误处理

## 附录：常见问题

### Q1：如何模拟网络延迟？
**A**：使用Chrome DevTools的Network标签，选择"Slow 3G"或自定义节流配置。

### Q2：如何查看API请求详情？
**A**：打开浏览器开发者工具Network标签，筛选XHR/Fetch请求，点击查看详情。

### Q3：如何验证订单状态是否真的更新到数据库？
**A**：
1. 查看Network响应数据
2. 刷新页面重新加载订单
3. 或直接查询MongoDB数据库

### Q4：测试环境和生产环境有什么区别？
**A**：
- 测试环境：`http://localhost:3001`
- 生产环境：实际部署的域名
- 确保`.env`配置正确
