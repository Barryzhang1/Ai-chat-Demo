# 聊天历史记录展示功能测试用例

## 测试环境
- 项目：ChatUI
- 页面：UserOrder
- 功能：历史记录展示

## 测试用例

### 用例1：正常加载历史记录
**前置条件：**
- 用户已登录
- 用户有历史聊天记录

**测试步骤：**
1. 打开智能点餐页面
2. 等待页面加载完成

**预期结果：**
- ✅ 页面成功加载历史记录
- ✅ 显示用户和助手的历史对话
- ✅ 用户消息显示在右侧，蓝色背景
- ✅ 助手消息显示在左侧，白色背景
- ✅ 时间戳正确显示

### 用例2：历史记录中包含菜品推荐
**前置条件：**
- 用户已登录
- 历史记录中包含 AI 推荐的菜品

**测试步骤：**
1. 打开智能点餐页面
2. 查看包含菜品的历史消息

**预期结果：**
- ✅ 正确解析 assistant 消息中的 JSON 内容
- ✅ 显示菜品名称、价格、图片
- ✅ 显示菜品数量（默认为1）
- ✅ 显示总价
- ✅ 点击菜品卡片可以打开菜单弹窗

**测试数据：**
```json
{
  "role": "assistant",
  "content": "{\n  \"message\": \"好的，已确认您的订单！菜品已全部加入购物车。\",\n  \"dishes\": [\"宫保鸡丁\", \"麻婆豆腐\", \"清炒时蔬\"]\n}",
  "timestamp": "2026-01-28T17:35:49.142Z"
}
```

### 用例3：首次访问（无历史记录）
**前置条件：**
- 用户已登录
- 用户没有历史聊天记录

**测试步骤：**
1. 打开智能点餐页面
2. 等待页面加载完成

**预期结果：**
- ✅ 显示默认欢迎消息
- ✅ 欢迎消息内容："您好！欢迎使用智能点餐系统。请告诉我您的点餐需求..."

### 用例4：历史记录加载失败
**前置条件：**
- 后端服务异常或网络错误

**测试步骤：**
1. 模拟网络错误
2. 打开智能点餐页面

**预期结果：**
- ✅ 显示默认欢迎消息
- ✅ 控制台输出错误日志
- ✅ 用户仍然可以正常发送新消息

### 用例5：菜品信息匹配
**前置条件：**
- 历史记录包含菜品名称
- 数据库中有对应的菜品信息

**测试步骤：**
1. 打开智能点餐页面
2. 查看历史记录中的菜品信息

**预期结果：**
- ✅ 菜品价格从数据库中正确获取
- ✅ 菜品图片正确显示
- ✅ 菜品描述正确显示
- ✅ 辣度标识正确显示

### 用例6：菜品信息缺失
**前置条件：**
- 历史记录包含菜品名称
- 数据库中没有对应的菜品信息（菜品已删除）

**测试步骤：**
1. 打开智能点餐页面
2. 查看历史记录中的菜品信息

**预期结果：**
- ✅ 仍然显示菜品名称
- ✅ 价格显示为 ¥0
- ✅ 显示默认占位图片
- ✅ 不影响其他消息的正常显示

### 用例7：JSON 解析异常
**前置条件：**
- 历史记录中包含格式错误的 JSON

**测试步骤：**
1. 打开智能点餐页面
2. 查看历史记录

**预期结果：**
- ✅ 显示原始文本内容
- ✅ 不会导致页面崩溃
- ✅ 控制台输出提示信息

### 用例8：消息顺序
**前置条件：**
- 用户有多条历史记录

**测试步骤：**
1. 打开智能点餐页面
2. 查看消息显示顺序

**预期结果：**
- ✅ 消息按时间顺序从上到下排列
- ✅ 最新的消息在最下方
- ✅ 页面自动滚动到最新消息

## 测试总结

### 功能覆盖
- [x] 基本功能：历史记录加载
- [x] 数据解析：JSON 格式解析
- [x] 数据匹配：菜品信息匹配
- [x] 异常处理：网络错误、数据缺失、解析失败
- [x] UI 展示：消息样式、菜品卡片、时间戳

### 需要注意的点
1. 后端返回的数据结构是嵌套的：`{ data: { messages: [...], total: number } }`
2. Assistant 消息的 content 可能包含 JSON 格式的字符串，需要解析
3. 菜品信息需要与数据库中的菜品数据进行匹配
4. 需要计算菜品总价
5. 需要正确处理各种异常情况

## 回归测试
在修改后需要测试的功能：
- [ ] 新消息发送功能正常
- [ ] 语音输入功能正常
- [ ] 菜单浏览功能正常
- [ ] 订单确认功能正常
- [ ] Socket 连接功能正常
