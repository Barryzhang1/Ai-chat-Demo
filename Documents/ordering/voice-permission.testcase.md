# 语音权限请求功能测试用例

## 功能概述
在用户聊天界面点击"按住说话"按钮时，请求并处理浏览器麦克风权限

## 测试环境
- **测试页面**：/user-order
- **涉及组件**：UserOrder.js
- **测试浏览器**：Chrome、Safari、Firefox

---

## 测试用例

### 用例1：首次请求麦克风权限
**测试步骤**：
1. 清除浏览器对该站点的所有权限设置
2. 进入用户点餐界面
3. 点击语音按钮切换到语音模式
4. 按住"按住说话"按钮

**预期结果**：
- ✅ 显示Toast提示："请允许使用麦克风以发送语音消息"
- ✅ 浏览器弹出麦克风权限请求对话框
- ✅ 用户允许后，开始录音并显示录音界面
- ✅ 录音界面显示波形动画

**实际结果**：[待测试]

---

### 用例2：用户允许麦克风权限
**前置条件**：用户首次或已允许麦克风权限

**测试步骤**：
1. 进入用户点餐界面
2. 点击语音按钮切换到语音模式
3. 按住"按住说话"按钮

**预期结果**：
- ✅ 显示Toast提示："请允许使用麦克风以发送语音消息"（仅首次）
- ✅ 立即开始录音
- ✅ 显示录音界面，包含波形动画
- ✅ 显示"松开 发送"、"取消"和"转文字"选项

**实际结果**：[待测试]

---

### 用例3：用户拒绝麦克风权限
**测试步骤**：
1. 清除浏览器权限设置
2. 进入用户点餐界面
3. 点击语音按钮切换到语音模式
4. 按住"按住说话"按钮
5. 在浏览器权限弹窗中选择"拒绝"或"阻止"

**预期结果**：
- ✅ 显示Toast提示："您拒绝了麦克风权限，无法使用语音功能"
- ✅ 持续时间3秒
- ✅ 不显示录音界面
- ✅ 录音状态重置为未录音

**实际结果**：[待测试]

---

### 用例4：权限已被永久拒绝
**前置条件**：用户之前已拒绝并勾选"不再询问"

**测试步骤**：
1. 进入用户点餐界面（权限已被永久拒绝）
2. 点击语音按钮切换到语音模式
3. 按住"按住说话"按钮

**预期结果**：
- ✅ 显示Dialog弹窗："麦克风权限已被禁止，请在浏览器设置中允许使用麦克风"
- ✅ 弹窗有"我知道了"按钮
- ✅ 不显示录音界面
- ✅ 录音状态重置为未录音

**实际结果**：[待测试]

---

### 用例5：未检测到麦克风设备
**测试环境**：没有麦克风的设备或禁用了麦克风设备

**测试步骤**：
1. 禁用或移除麦克风设备
2. 进入用户点餐界面
3. 点击语音按钮切换到语音模式
4. 按住"按住说话"按钮

**预期结果**：
- ✅ 显示Toast提示："未检测到麦克风设备"
- ✅ 持续时间3秒
- ✅ 不显示录音界面
- ✅ 录音状态重置为未录音

**实际结果**：[待测试]

---

### 用例6：麦克风被其他应用占用
**测试环境**：另一个应用正在使用麦克风

**测试步骤**：
1. 打开另一个应用（如视频会议软件）并启用麦克风
2. 进入用户点餐界面
3. 点击语音按钮切换到语音模式
4. 按住"按住说话"按钮

**预期结果**：
- ✅ 显示Toast提示："麦克风被其他应用占用"
- ✅ 持续时间3秒
- ✅ 不显示录音界面
- ✅ 录音状态重置为未录音

**实际结果**：[待测试]

---

### 用例7：权限检查API不支持（旧浏览器）
**测试环境**：不支持`navigator.permissions`的浏览器

**测试步骤**：
1. 使用不支持权限API的浏览器
2. 进入用户点餐界面
3. 点击语音按钮切换到语音模式
4. 按住"按住说话"按钮

**预期结果**：
- ✅ 直接请求麦克风权限（跳过权限检查）
- ✅ 显示Toast提示："请允许使用麦克风以发送语音消息"
- ✅ 浏览器弹出权限请求对话框
- ✅ 用户允许后正常录音

**实际结果**：[待测试]

---

### 用例8：正常录音并发送
**前置条件**：麦克风权限已允许

**测试步骤**：
1. 进入用户点餐界面
2. 点击语音按钮切换到语音模式
3. 按住"按住说话"按钮
4. 说话3秒钟
5. 松开按钮

**预期结果**：
- ✅ 开始录音并显示录音界面
- ✅ 波形动画正常播放
- ✅ 松开后发送语音消息
- ✅ 聊天区域显示语音消息气泡
- ✅ 显示Toast："语音发送成功"
- ✅ 录音状态重置

**实际结果**：[待测试]

---

## 兼容性测试

### 浏览器兼容性
| 浏览器 | 版本 | 权限API支持 | MediaRecorder支持 | 测试结果 |
|--------|------|------------|------------------|---------|
| Chrome | 最新 | ✅ | ✅ | [待测试] |
| Safari | 最新 | ⚠️ 部分支持 | ✅ | [待测试] |
| Firefox | 最新 | ✅ | ✅ | [待测试] |
| Edge | 最新 | ✅ | ✅ | [待测试] |

### 移动端兼容性
| 设备 | 系统 | 浏览器 | 测试结果 |
|------|------|--------|---------|
| iPhone | iOS 15+ | Safari | [待测试] |
| Android | Android 10+ | Chrome | [待测试] |

---

## 性能测试

### 响应时间
| 操作 | 预期时间 | 实际时间 |
|------|---------|---------|
| 权限检查 | < 100ms | [待测试] |
| 权限请求弹窗 | < 200ms | [待测试] |
| 开始录音 | < 300ms | [待测试] |

---

## 回归测试
- [ ] 确认不影响文本输入功能
- [ ] 确认不影响其他语音功能（播放、取消等）
- [ ] 确认不影响页面性能
- [ ] 确认不影响其他浏览器API调用

---

## 测试总结

### 通过的测试用例
[待填写]

### 失败的测试用例
[待填写]

### 发现的问题
[待填写]

### 改进建议
[待填写]
