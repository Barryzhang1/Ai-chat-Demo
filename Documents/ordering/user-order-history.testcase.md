# 用户历史订单查看功能测试用例

## 测试环境
- 项目：ChatUI
- 页面：UserOrder
- 功能：用户历史订单查看

## 测试用例

### 用例1：正常打开订单历史弹窗
**前置条件：**
- 用户已登录
- 用户有历史订单记录

**测试步骤：**
1. 打开智能点餐页面
2. 点击右上角的历史订单按钮

**预期结果：**
- ✅ 弹窗从底部滑出显示
- ✅ 显示用户的历史订单列表
- ✅ 订单按创建时间倒序排列
- ✅ 显示订单状态、时间、菜品、总价
- ✅ 弹窗高度为屏幕的80%

### 用例2：订单列表展示完整信息
**前置条件：**
- 用户已登录
- 用户有多个历史订单

**测试步骤：**
1. 打开订单历史弹窗
2. 查看订单卡片信息

**预期结果：**
- ✅ 订单号正确显示
- ✅ 订单状态标签颜色正确（待制作/制作中/已完成/已取消）
- ✅ 订单菜品列表完整展示（菜品名、数量、单价）
- ✅ 订单总价正确显示并高亮（红色粗体）
- ✅ 订单时间格式化显示（刚刚/X分钟前/X小时前/X天前）

### 用例3：订单状态展示
**前置条件：**
- 用户有不同状态的订单

**测试步骤：**
1. 打开订单历史弹窗
2. 查看不同状态订单的标签

**预期结果：**
- ✅ pending（待制作）显示黄色标签
- ✅ preparing（制作中）显示蓝色标签
- ✅ completed（已完成）显示灰色标签
- ✅ cancelled（已取消）显示红色标签

**测试数据：**
```json
{
  "_id": "60f7b3e3e8f3a12345678901",
  "userId": "user-123",
  "dishes": [
    {
      "dishId": "dish-456",
      "name": "宫保鸡丁",
      "price": 28,
      "quantity": 2
    }
  ],
  "totalPrice": 56,
  "status": "preparing",
  "createdAt": "2024-01-20T10:30:00.000Z"
}
```

### 用例4：无历史订单
**前置条件：**
- 用户已登录
- 用户没有历史订单

**测试步骤：**
1. 打开订单历史弹窗

**预期结果：**
- ✅ 显示空状态提示："暂无订单"
- ✅ 页面布局正常，不报错

### 用例5：下拉刷新订单
**前置条件：**
- 用户已登录
- 订单历史弹窗已打开

**测试步骤：**
1. 在订单列表向下拉动
2. 松开手指触发刷新

**预期结果：**
- ✅ 显示加载动画
- ✅ 重新加载订单数据
- ✅ 刷新完成后列表回到顶部
- ✅ 显示最新的订单数据

### 用例6：分页加载更多订单
**前置条件：**
- 用户有超过10条订单记录

**测试步骤：**
1. 打开订单历史弹窗
2. 滚动到列表底部

**预期结果：**
- ✅ 自动加载下一页订单
- ✅ 显示加载提示
- ✅ 新订单追加到列表底部
- ✅ 没有更多数据时显示"没有更多了"

### 用例7：订单加载失败
**前置条件：**
- 后端服务异常或网络错误

**测试步骤：**
1. 模拟网络错误
2. 打开订单历史弹窗

**预期结果：**
- ✅ 显示错误提示："加载失败，请重试"
- ✅ 弹窗仍然可以关闭
- ✅ 可以尝试重新刷新加载

### 用例8：关闭订单历史弹窗
**前置条件：**
- 订单历史弹窗已打开

**测试步骤：**
1. 点击弹窗外部区域
2. 或点击返回按钮

**预期结果：**
- ✅ 弹窗平滑关闭
- ✅ 返回智能点餐页面
- ✅ 不影响点餐聊天状态

### 用例9：时间格式化显示
**前置条件：**
- 用户有不同时间段的订单

**测试步骤：**
1. 打开订单历史弹窗
2. 查看不同订单的时间显示

**预期结果：**
- ✅ 1分钟内：显示"刚刚"
- ✅ 1-60分钟：显示"X分钟前"
- ✅ 1-24小时：显示"X小时前"
- ✅ 1-7天：显示"X天前"
- ✅ 7天以上：显示完整日期

### 用例10：订单菜品数量统计
**前置条件：**
- 订单包含多个菜品和数量

**测试步骤：**
1. 打开订单历史弹窗
2. 查看订单菜品数量统计

**预期结果：**
- ✅ 显示订单总菜品数量："共 X 件商品"
- ✅ 数量计算准确（所有菜品quantity之和）
- ✅ 菜品明细正确显示

**测试数据：**
```json
{
  "dishes": [
    { "name": "宫保鸡丁", "quantity": 2, "price": 28 },
    { "name": "麻婆豆腐", "quantity": 1, "price": 25 },
    { "name": "清炒时蔬", "quantity": 3, "price": 18 }
  ],
  "totalPrice": 135
}
```
预期显示："共 6 件商品"

## 边界情况测试

### 边界1：超长订单号
**测试数据：**
```
订单号：60f7b3e3e8f3a12345678901234567890abcdef
```
**预期：** 订单号自动换行或截断显示，不破坏布局

### 边界2：超长菜品名称
**测试数据：**
```
菜品名：红烧狮子头配特制秘制酱汁加时令蔬菜拼盘
```
**预期：** 菜品名自动换行显示，不超出卡片宽度

### 边界3：价格为0
**测试数据：**
```json
{ "totalPrice": 0 }
```
**预期：** 显示"¥0.00"

### 边界4：大量订单（100+）
**测试步骤：**
1. 用户有100+条订单
2. 打开订单历史并滚动

**预期：** 分页加载流畅，无卡顿，内存占用合理

## 性能测试

### 性能1：首次加载速度
**测试条件：** 加载10条订单
**预期：** 从点击按钮到显示订单列表 < 500ms

### 性能2：滚动流畅度
**测试条件：** 快速滚动订单列表
**预期：** 帧率保持在 55fps 以上，无明显卡顿

### 性能3：分页加载延迟
**测试条件：** 滚动到底部触发分页
**预期：** 下一页数据加载并渲染 < 1s

## 兼容性测试

### 兼容1：不同屏幕尺寸
**测试设备：**
- iPhone SE (375px)
- iPhone 12 (390px)
- iPhone 12 Pro Max (428px)
- iPad (768px)

**预期：** 所有设备上布局正常，信息完整显示

### 兼容2：不同浏览器
**测试浏览器：**
- Safari (iOS 15+)
- Chrome (Android)
- 微信内置浏览器

**预期：** 所有浏览器功能正常，样式一致

## 回归测试检查清单

- [ ] 点击历史订单按钮，弹窗正常打开
- [ ] 订单列表正确显示，信息完整
- [ ] 订单状态颜色正确
- [ ] 下拉刷新功能正常
- [ ] 分页加载功能正常
- [ ] 空状态显示正常
- [ ] 时间格式化正确
- [ ] 关闭弹窗功能正常
- [ ] 不影响原有点餐功能
- [ ] 错误处理正常
