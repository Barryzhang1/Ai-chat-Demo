# 权限管理系统测试用例

## 1. 后端API测试用例

### 1.1 获取用户列表接口测试

#### 测试用例 1.1.1：成功获取用户列表
- **测试目标**：老板角色成功获取所有用户列表
- **前置条件**：
  - 已有多个注册用户
  - 使用老板角色的有效Token
- **测试步骤**：
  1. 发送GET请求到 `/api/users/list`
  2. 在请求头中携带老板角色的Token
- **预期结果**：
  - 返回状态码200
  - 返回所有用户列表
  - 每个用户包含：_id, username, role, createdAt, updatedAt
  - 不包含password字段

#### 测试用例 1.1.2：未登录访问
- **测试目标**：未登录用户无法访问用户列表
- **前置条件**：无Token或Token无效
- **测试步骤**：
  1. 发送GET请求到 `/api/users/list`
  2. 不携带Token或携带无效Token
- **预期结果**：
  - 返回状态码401
  - 返回错误信息："未授权访问"

#### 测试用例 1.1.3：非老板角色访问
- **测试目标**：员工和用户角色无法访问用户列表
- **前置条件**：使用员工或用户角色的Token
- **测试步骤**：
  1. 发送GET请求到 `/api/users/list`
  2. 携带员工或用户角色的Token
- **预期结果**：
  - 返回状态码403
  - 返回错误信息："权限不足"

### 1.2 更新用户角色接口测试

#### 测试用例 1.2.1：老板成功修改用户角色
- **测试目标**：老板角色成功修改其他用户角色
- **前置条件**：
  - 存在目标用户（当前角色为USER）
  - 使用老板角色的有效Token
- **测试步骤**：
  1. 发送PATCH请求到 `/api/users/{userId}/role`
  2. 请求体：`{"role": "STAFF"}`
  3. 携带老板角色的Token
- **预期结果**：
  - 返回状态码200
  - 返回更新后的用户信息
  - 用户角色已变更为STAFF
  - updatedAt时间戳已更新

#### 测试用例 1.2.2：修改为无效角色
- **测试目标**：拒绝修改为不存在的角色
- **前置条件**：使用老板角色的Token
- **测试步骤**：
  1. 发送PATCH请求到 `/api/users/{userId}/role`
  2. 请求体：`{"role": "INVALID_ROLE"}`
- **预期结果**：
  - 返回状态码400
  - 返回错误信息："无效的角色类型"

#### 测试用例 1.2.3：员工尝试修改角色
- **测试目标**：员工角色无权修改用户角色
- **前置条件**：使用员工角色的Token
- **测试步骤**：
  1. 发送PATCH请求到 `/api/users/{userId}/role`
  2. 请求体：`{"role": "STAFF"}`
- **预期结果**：
  - 返回状态码403
  - 返回错误信息："权限不足，只有老板可以修改用户角色"

#### 测试用例 1.2.4：修改不存在的用户
- **测试目标**：拒绝修改不存在的用户
- **前置条件**：使用老板角色的Token
- **测试步骤**：
  1. 发送PATCH请求到 `/api/users/invalidUserId/role`
  2. 使用不存在的用户ID
- **预期结果**：
  - 返回状态码404
  - 返回错误信息："用户不存在"

#### 测试用例 1.2.5：缺少必填参数
- **测试目标**：请求体缺少role参数
- **前置条件**：使用老板角色的Token
- **测试步骤**：
  1. 发送PATCH请求到 `/api/users/{userId}/role`
  2. 请求体为空或不包含role字段
- **预期结果**：
  - 返回状态码400
  - 返回错误信息："缺少必填参数：role"

## 2. 前端功能测试用例

### 2.1 页面访问权限测试

#### 测试用例 2.1.1：老板角色访问权限管理页面
- **测试目标**：老板可以访问权限管理页面
- **前置条件**：使用老板角色账号登录
- **测试步骤**：
  1. 登录商家后台
  2. 点击左侧导航栏"权限管理"菜单
- **预期结果**：
  - 成功进入权限管理页面
  - 显示用户列表

#### 测试用例 2.1.2：员工角色访问权限管理页面
- **测试目标**：员工无法访问权限管理页面
- **前置条件**：使用员工角色账号登录
- **测试步骤**：
  1. 登录商家后台
  2. 查看左侧导航栏
- **预期结果**：
  - 导航栏中不显示"权限管理"菜单
  - 或点击后提示"权限不足"

#### 测试用例 2.1.3：用户角色访问权限管理页面
- **测试目标**：普通用户无法访问权限管理页面
- **前置条件**：使用普通用户角色账号登录
- **测试步骤**：
  1. 登录商家后台
  2. 查看左侧导航栏
- **预期结果**：
  - 导航栏中不显示"权限管理"菜单

### 2.2 用户列表展示测试

#### 测试用例 2.2.1：正常展示用户列表
- **测试目标**：页面正确展示所有用户信息
- **前置条件**：
  - 老板角色已登录
  - 系统中存在多个用户
- **测试步骤**：
  1. 进入权限管理页面
  2. 查看用户列表
- **预期结果**：
  - 显示表格包含列：用户名、角色、注册时间
  - 每个用户显示完整信息
  - 不显示密码等敏感信息
  - 每行有角色修改操作

#### 测试用例 2.2.2：空用户列表展示
- **测试目标**：当没有其他用户时的展示
- **前置条件**：系统中只有当前登录的老板用户
- **测试步骤**：
  1. 进入权限管理页面
- **预期结果**：
  - 显示当前登录用户
  - 或显示"暂无其他用户"提示

#### 测试用例 2.2.3：列表加载失败
- **测试目标**：API请求失败时的错误处理
- **前置条件**：
  - 后端服务异常或网络错误
- **测试步骤**：
  1. 进入权限管理页面
  2. 模拟API请求失败
- **预期结果**：
  - 显示错误提示信息
  - 提供重试按钮

### 2.3 角色修改功能测试

#### 测试用例 2.3.1：成功修改用户角色
- **测试目标**：通过下拉框成功修改用户角色
- **前置条件**：
  - 老板角色已登录
  - 存在目标用户
- **测试步骤**：
  1. 进入权限管理页面
  2. 找到目标用户行
  3. 点击角色下拉选择框
  4. 选择新角色（如：STAFF）
  5. 确认修改
- **预期结果**：
  - 下拉框显示三个选项：老板、员工、用户
  - 选择后自动保存
  - 显示成功提示消息
  - 列表中角色立即更新
  - 无需刷新页面

#### 测试用例 2.3.2：下拉框选项正确性
- **测试目标**：验证角色选择器显示正确的选项
- **前置条件**：老板角色已登录
- **测试步骤**：
  1. 进入权限管理页面
  2. 点击任意用户的角色下拉框
- **预期结果**：
  - 显示三个选项：老板、员工、用户
  - 当前角色被高亮选中
  - 选项文字清晰可读

#### 测试用例 2.3.3：角色修改失败处理
- **测试目标**：修改失败时的错误提示
- **前置条件**：
  - 模拟API请求失败
- **测试步骤**：
  1. 尝试修改用户角色
  2. API返回错误
- **预期结果**：
  - 显示错误提示消息
  - 角色保持原状
  - 提供重试选项

#### 测试用例 2.3.4：并发修改测试
- **测试目标**：快速连续修改多个用户角色
- **前置条件**：存在多个用户
- **测试步骤**：
  1. 快速修改用户A的角色
  2. 立即修改用户B的角色
- **预期结果**：
  - 两个修改都成功
  - 没有数据错乱
  - 显示正确的成功提示

### 2.4 UI/UX测试

#### 测试用例 2.4.1：响应式布局测试
- **测试目标**：页面在不同屏幕尺寸下正常显示
- **测试步骤**：
  1. 在不同设备上打开页面（桌面、平板、手机）
  2. 调整浏览器窗口大小
- **预期结果**：
  - 表格自适应屏幕宽度
  - 所有元素可见且可操作
  - 无横向滚动条（移动端可接受）

#### 测试用例 2.4.2：加载状态显示
- **测试目标**：数据加载时显示加载指示器
- **前置条件**：模拟较慢的网络环境
- **测试步骤**：
  1. 进入权限管理页面
  2. 观察加载过程
- **预期结果**：
  - 显示加载动画或骨架屏
  - 加载完成后显示实际数据

#### 测试用例 2.4.3：用户交互反馈
- **测试目标**：所有操作都有清晰的视觉反馈
- **测试步骤**：
  1. 鼠标悬停在可操作元素上
  2. 点击按钮
  3. 修改角色
- **预期结果**：
  - 悬停时有视觉变化（颜色、阴影等）
  - 点击时有反馈效果
  - 操作成功/失败都有明确提示

## 3. 集成测试用例

### 测试用例 3.1：完整流程测试
- **测试目标**：验证从登录到修改角色的完整流程
- **测试步骤**：
  1. 使用老板账号登录
  2. 进入权限管理页面
  3. 查看用户列表
  4. 修改某用户角色为STAFF
  5. 退出登录
  6. 使用被修改的用户账号登录
  7. 验证该用户的权限已变更
- **预期结果**：
  - 所有步骤顺利完成
  - 角色修改立即生效
  - 用户权限符合新角色

### 测试用例 3.2：权限边界测试
- **测试目标**：验证权限控制的有效性
- **测试步骤**：
  1. 用老板账号将用户A的角色改为STAFF
  2. 退出登录
  3. 用用户A（STAFF）账号登录
  4. 尝试访问权限管理页面
- **预期结果**：
  - 用户A无法访问权限管理页面
  - 显示权限不足提示

## 4. 性能测试用例

### 测试用例 4.1：大量用户列表加载
- **测试目标**：测试大量用户数据的加载性能
- **前置条件**：系统中有100+用户
- **测试步骤**：
  1. 进入权限管理页面
  2. 记录页面加载时间
- **预期结果**：
  - 页面加载时间 < 3秒
  - 列表渲染流畅
  - 无明显卡顿

### 测试用例 4.2：频繁修改角色
- **测试目标**：测试频繁修改操作的系统稳定性
- **测试步骤**：
  1. 连续修改同一用户的角色10次
  2. 观察系统响应
- **预期结果**：
  - 每次修改都成功
  - 无内存泄漏
  - 系统保持稳定

## 5. 安全测试用例

### 测试用例 5.1：Token过期处理
- **测试目标**：Token过期时的处理
- **测试步骤**：
  1. 登录后等待Token过期
  2. 尝试修改用户角色
- **预期结果**：
  - 返回401错误
  - 自动跳转到登录页
  - 提示"登录已过期，请重新登录"

### 测试用例 5.2：XSS攻击防护
- **测试目标**：防止跨站脚本攻击
- **测试步骤**：
  1. 创建包含脚本代码的用户名
  2. 在权限管理页面查看该用户
- **预期结果**：
  - 脚本代码被转义显示
  - 不执行恶意脚本

### 测试用例 5.3：SQL注入防护
- **测试目标**：防止SQL注入攻击
- **测试步骤**：
  1. 尝试使用SQL注入语句修改角色
  2. 如：`{"role": "BOSS' OR '1'='1"}`
- **预期结果**：
  - 请求被拒绝
  - 返回参数验证错误
