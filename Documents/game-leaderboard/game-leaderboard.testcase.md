# 游戏排行榜功能测试用例

## 测试环境
- FlappyBird: http://localhost:8080
- ChatBackEnd: http://localhost:3000
- ChatUI: http://localhost:3001

## 一、FlappyBird游戏端测试

### 测试用例 1.1: 游戏结束提交分数（已登录用户）
**前置条件**: 用户已登录
**测试步骤**:
1. 启动游戏
2. 玩游戏直到死亡
3. 观察是否自动提交分数
4. 检查网络请求

**预期结果**:
- 游戏结束后自动发送POST请求到 `/api/game-scores`
- 请求包含玩家名称、分数、游戏类型、游戏时长
- 收到成功响应
- 控制台无错误信息

### 测试用例 1.2: 游戏结束提交分数（匿名用户）
**前置条件**: 用户未登录
**测试步骤**:
1. 未登录状态启动游戏
2. 玩游戏直到死亡
3. 输入玩家昵称（如果需要）
4. 提交分数

**预期结果**:
- 允许匿名用户提交分数
- 使用输入的昵称或默认昵称
- 成功提交到后端

### 测试用例 1.3: 网络异常情况
**前置条件**: 断开网络或后端服务不可用
**测试步骤**:
1. 断开网络连接
2. 玩游戏直到死亡
3. 观察错误处理

**预期结果**:
- 显示友好的错误提示
- 分数本地保存
- 游戏可以继续进行

## 二、ChatBackEnd后端测试

### 测试用例 2.1: 提交游戏分数 API（首次提交）
**接口**: POST /api/game-scores
**测试数据**:
```json
{
  "playerName": "测试玩家A",
  "score": 100,
  "gameType": "FlappyBird",
  "playTime": 60
}
```

**预期结果**:
- 返回状态码 200 或 201
- 返回包含 _id, score, rank, isNewRecord, isHighScore 的数据
- isNewRecord 为 true（首次提交）
- isHighScore 为 true（是最高分）
- 数据成功存入MongoDB
- 创建时间自动生成

### 测试用例 2.1.1: 提交游戏分数（更高分数）
**前置条件**: 测试玩家A已有分数100
**测试数据**:
```json
{
  "playerName": "测试玩家A",
  "score": 150,
  "gameType": "FlappyBird",
  "playTime": 80
}
```

**预期结果**:
- 返回状态码 200 或 201
- isNewRecord 为 false（更新记录）
- isHighScore 为 true（打破了自己的最高分）
- 数据库中该玩家的分数更新为150
- 数据库中该玩家只有一条记录
- updatedAt 时间更新

### 测试用例 2.1.2: 提交游戏分数（更低分数）
**前置条件**: 测试玩家A已有最高分150
**测试数据**:
```json
{
  "playerName": "测试玩家A",
  "score": 80,
  "gameType": "FlappyBird",
  "playTime": 40
}
```

**预期结果**:
- 返回状态码 200 或 201
- isNewRecord 为 false（不创建新记录）
- isHighScore 为 false（未打破最高分）
- 数据库中该玩家的分数仍为150（未更新）
- 数据库中该玩家只有一条记录
- 返回的分数是最高分150，而不是本次的80

### 测试用例 2.1.3: 不同玩家独立记录
**测试数据**:
```json
// 玩家B首次提交
{
  "playerName": "测试玩家B",
  "score": 120,
  "gameType": "FlappyBird",
  "playTime": 70
}
```

**预期结果**:
- 玩家B成功创建新记录
- 不影响玩家A的记录
- 数据库中每个玩家只有一条记录
- 排行榜按分数排序：A(150) > B(120)

### 测试用例 2.2: 参数验证
**测试步骤**:
测试以下无效请求：
1. 缺少 playerName
2. 缺少 score
3. score 为负数
4. score 超过合理范围（如 >10000）
5. 缺少 gameType

**预期结果**:
- 返回 400 Bad Request
- 返回清晰的错误信息
- 数据库不插入无效数据

### 测试用例 2.3: 查询总排行榜
**接口**: GET /api/game-scores/leaderboard?gameType=FlappyBird&period=all&page=1&limit=10

**预期结果**:
- 返回状态码 200
- 返回按分数降序排列的数据
- 包含 rank 字段（排名）
- 分页信息正确（total, page, limit）

### 测试用例 2.4: 查询日榜
**接口**: GET /api/game-scores/leaderboard?gameType=FlappyBird&period=today&page=1&limit=10

**预期结果**:
- 只返回今天的数据
- 按分数降序排列
- 数据时间范围正确

### 测试用例 2.5: 查询周榜
**接口**: GET /api/game-scores/leaderboard?gameType=FlappyBird&period=week&page=1&limit=10

**预期结果**:
- 只返回最近7天的数据
- 按分数降序排列

### 测试用例 2.6: 查询月榜
**接口**: GET /api/game-scores/leaderboard?gameType=FlappyBird&period=month&page=1&limit=10

**预期结果**:
- 只返回本月的数据
- 按分数降序排列

### 测试用例 2.7: 分页功能
**测试步骤**:
1. 插入 50 条测试数据
2. 查询第 1 页，每页 10 条
3. 查询第 2 页，每页 10 条
4. 查询第 5 页，每页 10 条

**预期结果**:
- 每页返回正确数量的数据
- total 为 50
- 不同页返回不同数据
- 最后一页可能少于 10 条

### 测试用例 2.8: 性能测试
**测试步骤**:
1. 插入 10000 条数据
2. 查询排行榜

**预期结果**:
- 响应时间 < 1 秒
- 数据库查询有索引支持
- 分页查询效率高

## 三、ChatUI商家管理界面测试

### 测试用例 3.1: 排行榜页面展示
**前置条件**: 商家已登录
**测试步骤**:
1. 登录商家管理后台
2. 点击"游戏排行榜"菜单
3. 观察页面展示

**预期结果**:
- 页面正常加载
- 显示排行榜表格
- 表格包含：排名、玩家、分数、时间
- 默认显示总榜

### 测试用例 3.2: 切换榜单类型
**测试步骤**:
1. 进入排行榜页面
2. 点击"日榜"标签
3. 点击"周榜"标签
4. 点击"月榜"标签
5. 点击"总榜"标签

**预期结果**:
- 每次切换都重新加载对应数据
- 数据时间范围符合选择的类型
- 页面切换流畅无卡顿

### 测试用例 3.3: 分页功能
**前置条件**: 数据库有超过 10 条记录
**测试步骤**:
1. 进入排行榜页面
2. 点击翻页按钮
3. 修改每页显示数量

**预期结果**:
- 翻页正常工作
- 显示正确的页码
- 每页数量设置生效

### 测试用例 3.4: 数据刷新
**测试步骤**:
1. 打开排行榜页面
2. 在游戏中提交新分数
3. 点击刷新按钮

**预期结果**:
- 新数据出现在排行榜中
- 排名重新计算
- 界面更新及时

### 测试用例 3.5: 导出功能
**测试步骤**:
1. 进入排行榜页面
2. 点击"导出"按钮

**预期结果**:
- 下载 Excel 或 CSV 文件
- 文件包含当前页或全部数据
- 数据格式正确

### 测试用例 3.6: 空数据展示
**前置条件**: 数据库无游戏分数数据
**测试步骤**:
1. 清空游戏分数数据
2. 访问排行榜页面

**预期结果**:
- 显示"暂无数据"提示
- 页面不报错
- 界面友好

### 测试用例 3.7: 响应式布局
**测试步骤**:
1. 在不同屏幕尺寸下打开页面
2. 缩放浏览器窗口

**预期结果**:
- 移动端显示适配
- 表格支持横向滚动
- 布局不错乱

## 四、集成测试

### 测试用例 4.1: 完整流程测试
**测试步骤**:
1. 打开FlappyBird游戏
2. 开始游戏并获得分数
3. 游戏结束，分数自动提交
4. 切换到商家管理界面
5. 查看游戏排行榜

**预期结果**:
- 整个流程顺畅
- 分数正确显示在排行榜中
- 排名准确
- 时间正确

### 测试用例 4.2: 并发测试
**测试步骤**:
1. 模拟多个玩家同时提交分数
2. 查看排行榜

**预期结果**:
- 所有分数都成功保存
- 排行榜数据一致
- 没有数据丢失
- 排名正确

### 测试用例 4.3: 数据一致性测试
**测试步骤**:
1. 提交分数到后端
2. 立即查询排行榜
3. 等待1秒后再次查询

**预期结果**:
- 数据实时更新
- 两次查询结果一致
- 排名计算正确

## 五、边界测试

### 测试用例 5.1: 最大分数测试
**测试数据**: score = 999999

**预期结果**:
- 能够正确保存和显示
- 排在第一位

### 测试用例 5.2: 零分测试
**测试数据**: score = 0

**预期结果**:
- 能够正确保存
- 显示在排行榜末尾

### 测试用例 5.3: 长玩家名测试
**测试数据**: playerName = "A" * 100

**预期结果**:
- 名称被截断或拒绝
- 显示时不破坏布局

### 测试用例 5.4: 特殊字符测试
**测试数据**: playerName包含特殊字符（<script>, emoji等）

**预期结果**:
- 防止XSS攻击
- 特殊字符正确转义或过滤
- 界面正常显示

## 六、兼容性测试

### 测试用例 6.1: 浏览器兼容性
**测试范围**:
- Chrome
- Firefox
- Safari
- Edge

**预期结果**:
- 所有功能在各浏览器正常工作

### 测试用例 6.2: 移动端兼容性
**测试设备**:
- iOS Safari
- Android Chrome

**预期结果**:
- 游戏和排行榜在移动端正常工作
- 触摸操作流畅
